<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>AkiEvergarden</title>
  
  <subtitle>å¸¸ç»¿ä¹‹æ£®</subtitle>
  <link href="https://blog.akievergarden.top/atom.xml" rel="self"/>
  
  <link href="https://blog.akievergarden.top/"/>
  <updated>2024-03-20T12:59:53.194Z</updated>
  <id>https://blog.akievergarden.top/</id>
  
  <author>
    <name>AkiEvergarden</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>gitlabæ­å»ºå’Œè‡ªåŠ¨åŒ–</title>
    <link href="https://blog.akievergarden.top/2024/03/20/gitlab%E6%90%AD%E5%BB%BA%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
    <id>https://blog.akievergarden.top/2024/03/20/gitlab%E6%90%AD%E5%BB%BA%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96/</id>
    <published>2024-03-20T12:39:29.000Z</published>
    <updated>2024-03-20T12:59:53.194Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ğŸ¤–-è‡ªåŠ¨åŒ–éƒ¨ç½²"><a href="#ğŸ¤–-è‡ªåŠ¨åŒ–éƒ¨ç½²" class="headerlink" title="ğŸ¤– è‡ªåŠ¨åŒ–éƒ¨ç½²"></a>ğŸ¤– è‡ªåŠ¨åŒ–éƒ¨ç½²</h1><h1 id="æ‰§è¡Œè¿‡ç¨‹"><a href="#æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹"></a>æ‰§è¡Œè¿‡ç¨‹</h1><p><img src="https://upyun.akievergarden.top/blog/gitlab/6141a5f9-2cb5-4321-b596-7fe22bca4868.png" alt="è¿‡ç¨‹"></p><h1 id="é…ç½®è¿‡ç¨‹"><a href="#é…ç½®è¿‡ç¨‹" class="headerlink" title="é…ç½®è¿‡ç¨‹"></a>é…ç½®è¿‡ç¨‹</h1><blockquote><p>æœ¬æ•™ç¨‹é»˜è®¤å®‰è£… nginxï¼Œdocker å’Œ docker-compose</p></blockquote><p>å…¨æ–‡å‚è€ƒé“¾æ¥ï¼š <a href="https://blog.csdn.net/amethystcity/article/details/104843735">https://blog.csdn.net/amethystcity/article/details/104843735</a></p><h2 id="1-æ­å»ºGitlabEE"><a href="#1-æ­å»ºGitlabEE" class="headerlink" title="1. æ­å»ºGitlabEE"></a>1. æ­å»ºGitlabEE</h2><h3 id="1-1-è·å–GitLabç ´è§£æ–‡ä»¶"><a href="#1-1-è·å–GitLabç ´è§£æ–‡ä»¶" class="headerlink" title="1.1 è·å–GitLabç ´è§£æ–‡ä»¶"></a>1.1 è·å–GitLabç ´è§£æ–‡ä»¶</h3><p>å‚è€ƒé“¾æ¥ï¼š <a href="https://developer.aliyun.com/article/893530">https://developer.aliyun.com/article/893530</a></p><ol><li><p>å®‰è£… Ruby</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update sudo </span><br><span class="line">apt install ruby-full</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>ç”Ÿæˆè®¸å¯è¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gem install gitlab-license</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>è¾“å…¥å†…å®¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; license.rb</span><br><span class="line"> </span><br><span class="line">require <span class="string">&quot;openssl&quot;</span></span><br><span class="line">require <span class="string">&quot;gitlab/license&quot;</span></span><br><span class="line">key_pair = OpenSSL::PKey::RSA.generate(2048)</span><br><span class="line">File.open(<span class="string">&quot;license_key&quot;</span>, <span class="string">&quot;w&quot;</span>) &#123; |f| f.write(key_pair.to_pem) &#125;</span><br><span class="line">public_key = key_pair.public_key</span><br><span class="line">File.open(<span class="string">&quot;license_key.pub&quot;</span>, <span class="string">&quot;w&quot;</span>) &#123; |f| f.write(public_key.to_pem) &#125;</span><br><span class="line">private_key = OpenSSL::PKey::RSA.new File.<span class="built_in">read</span>(<span class="string">&quot;license_key&quot;</span>)</span><br><span class="line">Gitlab::License.encryption_key = private_key</span><br><span class="line">license = Gitlab::License.new</span><br><span class="line">license.licensee = &#123;</span><br><span class="line">  <span class="string">&quot;Name&quot;</span> =&gt; <span class="string">&quot;none&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Company&quot;</span> =&gt; <span class="string">&quot;none&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Email&quot;</span> =&gt; <span class="string">&quot;example@test.com&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">license.starts_at = Date.new(2020, 1, 1) <span class="comment"># å¼€å§‹æ—¶é—´</span></span><br><span class="line">license.expires_at = Date.new(2050, 1, 1) <span class="comment"># ç»“æŸæ—¶é—´</span></span><br><span class="line">license.notify_admins_at = Date.new(2049, 12, 1)</span><br><span class="line">license.notify_users_at = Date.new(2049, 12, 1)</span><br><span class="line">license.block_changes_at = Date.new(2050, 1, 1)</span><br><span class="line">license.restrictions = &#123;</span><br><span class="line">  active_user_count: 10000,</span><br><span class="line">&#125;</span><br><span class="line">puts <span class="string">&quot;License:&quot;</span></span><br><span class="line">puts license</span><br><span class="line">data = license.export</span><br><span class="line">puts <span class="string">&quot;Exported license:&quot;</span></span><br><span class="line">puts data</span><br><span class="line">File.open(<span class="string">&quot;GitLabBV.gitlab-license&quot;</span>, <span class="string">&quot;w&quot;</span>) &#123; |f| f.write(data) &#125;</span><br><span class="line">public_key = OpenSSL::PKey::RSA.new File.<span class="built_in">read</span>(<span class="string">&quot;license_key.pub&quot;</span>)</span><br><span class="line">Gitlab::License.encryption_key = public_key</span><br><span class="line">data = File.<span class="built_in">read</span>(<span class="string">&quot;GitLabBV.gitlab-license&quot;</span>)</span><br><span class="line"><span class="variable">$license</span> = Gitlab::License.import(data)</span><br><span class="line">puts <span class="string">&quot;Imported license:&quot;</span></span><br><span class="line">puts <span class="variable">$license</span></span><br><span class="line">unless <span class="variable">$license</span></span><br><span class="line">  raise <span class="string">&quot;The license is invalid.&quot;</span></span><br><span class="line">end</span><br><span class="line"><span class="keyword">if</span> <span class="variable">$license</span>.restricted?(:active_user_count)</span><br><span class="line">  active_user_count = 10000</span><br><span class="line">  <span class="keyword">if</span> active_user_count &gt; <span class="variable">$license</span>.restrictions[:active_user_count]</span><br><span class="line">    raise <span class="string">&quot;The active user count exceeds the allowed amount!&quot;</span></span><br><span class="line">  end</span><br><span class="line">end</span><br><span class="line"><span class="keyword">if</span> <span class="variable">$license</span>.notify_admins?</span><br><span class="line">  puts <span class="string">&quot;The license is due to expire on #&#123;<span class="variable">$license</span>.expires_at&#125;.&quot;</span></span><br><span class="line">end</span><br><span class="line"><span class="keyword">if</span> <span class="variable">$license</span>.notify_users?</span><br><span class="line">  puts <span class="string">&quot;The license is due to expire on #&#123;<span class="variable">$license</span>.expires_at&#125;.&quot;</span></span><br><span class="line">end</span><br><span class="line">module Gitlab</span><br><span class="line">  class GitAccess</span><br><span class="line">    def check(cmd, changes = nil)</span><br><span class="line">      <span class="keyword">if</span> <span class="variable">$license</span>.block_changes?</span><br><span class="line">        <span class="built_in">return</span> build_status_object(<span class="literal">false</span>, <span class="string">&quot;License expired&quot;</span>)</span><br><span class="line">      end</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">end</span><br><span class="line">puts <span class="string">&quot;This instance of GitLab Enterprise Edition is licensed to:&quot;</span></span><br><span class="line"><span class="variable">$license</span>.licensee.each <span class="keyword">do</span> |key, value|</span><br><span class="line">  puts <span class="string">&quot;#&#123;key&#125;: #&#123;value&#125;&quot;</span></span><br><span class="line">end</span><br><span class="line"><span class="keyword">if</span> <span class="variable">$license</span>.expired?</span><br><span class="line">  puts <span class="string">&quot;The license expired on #&#123;<span class="variable">$license</span>.expires_at&#125;&quot;</span></span><br><span class="line">elsif <span class="variable">$license</span>.will_expire?</span><br><span class="line">  puts <span class="string">&quot;The license will expire on #&#123;<span class="variable">$license</span>.expires_at&#125;&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  puts <span class="string">&quot;The license will never expire.&quot;</span></span><br><span class="line">end</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ctrl + c é€€å‡ºç¼–è¾‘</p></li><li><p>ç”Ÿæˆæ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ruby license.rb</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”Ÿæˆåœ¨rootä¸‹ GitLabBV.gitlab-license license_key license_key.pub è¿™ä¸‰ä¸ªæ–‡ä»¶ã€‚</p></li></ol><h3 id="1-2-ä½¿ç”¨docker-compse-å®Œæˆå®‰è£…"><a href="#1-2-ä½¿ç”¨docker-compse-å®Œæˆå®‰è£…" class="headerlink" title="1.2 ä½¿ç”¨docker-compse å®Œæˆå®‰è£…"></a>1.2 ä½¿ç”¨docker-compse å®Œæˆå®‰è£…</h3><p>å‚è€ƒè½»é‡åŒ–è¿è¡Œï¼š <a href="https://zhuanlan.zhihu.com/p/389717047">https://zhuanlan.zhihu.com/p/389717047</a></p><p>docker-compose å†…å®¹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">gitlab:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&#x27;gitlab/gitlab-ee:latest&#x27;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">&#x27;gitlab&#x27;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line">      <span class="attr">GITLAB_OMNIBUS_CONFIG:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        external_url &#x27;https://git.akievergarden.top&#x27;  # webç«™ç‚¹è®¿é—®åœ°å€ ä½¿ç”¨nginxè¿›è¡Œåå‘ä»£ç†</span></span><br><span class="line"><span class="string">        gitlab_rails[&#x27;gitlab_shell_ssh_port&#x27;] = 222</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">        <span class="comment"># Terraform</span></span><br><span class="line">        <span class="string">gitlab_rails[&#x27;terraform_state_enabled&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Usage Statistics</span></span><br><span class="line">        <span class="string">gitlab_rails[&#x27;usage_ping_enabled&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="string">gitlab_rails[&#x27;sentry_enabled&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="string">grafana[&#x27;reporting_enabled&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å…³é—­å®¹å™¨ä»“åº“åŠŸèƒ½</span></span><br><span class="line">        <span class="string">gitlab_rails[&#x27;gitlab_default_projects_features_container_registry&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="string">gitlab_rails[&#x27;registry_enabled&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="string">registry[&#x27;enable&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="string">registry_nginx[&#x27;enable&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># åŒ…ä»“åº“</span></span><br><span class="line">        <span class="string">gitlab_rails[&#x27;packages_enabled&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="string">gitlab_rails[&#x27;dependency_proxy_enabled&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># GitLab KAS</span></span><br><span class="line">        <span class="string">gitlab_kas[&#x27;enable&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="string">gitlab_rails[&#x27;gitlab_kas_enabled&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Mattermost</span></span><br><span class="line">        <span class="string">mattermost[&#x27;enable&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="string">mattermost_nginx[&#x27;enable&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Kerberos</span></span><br><span class="line">        <span class="string">gitlab_rails[&#x27;kerberos_enabled&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="string">sentinel[&#x27;enable&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># GitLab Pages</span></span><br><span class="line">        <span class="string">gitlab_pages[&#x27;enable&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="string">pages_nginx[&#x27;enable&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç¦ç”¨ PUMA é›†ç¾¤æ¨¡å¼</span></span><br><span class="line">        <span class="string">puma[&#x27;worker_processes&#x27;]</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line">        <span class="string">puma[&#x27;min_threads&#x27;]</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line">        <span class="string">puma[&#x27;max_threads&#x27;]</span> <span class="string">=</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># é™ä½åå°å®ˆæŠ¤è¿›ç¨‹å¹¶å‘æ•°</span></span><br><span class="line">        <span class="string">sidekiq[&#x27;max_concurrency&#x27;]</span> <span class="string">=</span> <span class="number">5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å…³é—­ç›‘æ§</span></span><br><span class="line">        <span class="string">prometheus_monitoring[&#x27;enable&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="string">alertmanager[&#x27;enable&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="string">node_exporter[&#x27;enable&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="string">redis_exporter[&#x27;enable&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="string">postgres_exporter[&#x27;enable&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="string">pgbouncer_exporter[&#x27;enable&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="string">gitlab_exporter[&#x27;enable&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="string">grafana[&#x27;enable&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="string">sidekiq[&#x27;metrics_enabled&#x27;]</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;13000:80&#x27;</span> <span class="comment">#é…ç½®äº†external_url &#x27;https://git.akievergarden.top&#x27; å³ httpså¯ä»¥ä¸éœ€è¦æ˜ å°„è¯¥ç«¯å£</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;8443:443&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;222:22&#x27;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./gitlab/config:/etc/gitlab</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./gitlab/data:/var/opt/gitlab</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./gitlab/logs:/var/log/gitlab</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./gitlab/.license_encryption_key.pub:/opt/gitlab/embedded/service/gitlab-rails/.license_encryption_key.pub</span> </span><br><span class="line">    <span class="attr">logging:</span></span><br><span class="line">      <span class="attr">driver:</span> <span class="string">&#x27;json-file&#x27;</span></span><br><span class="line">      <span class="attr">options:</span></span><br><span class="line">        <span class="attr">max-size:</span> <span class="string">&#x27;2g&#x27;</span></span><br><span class="line">        </span><br></pre></td></tr></table></figure><blockquote><p>.&#x2F;gitlab&#x2F;.license_encryption_key.pub:&#x2F;opt&#x2F;gitlab&#x2F;embedded&#x2F;service&#x2F;gitlab-rails&#x2F;.license_encryption_key.pub</p></blockquote><blockquote><p>å°†ä¸Šä¸€æ­¥éª¤ä¸­çš„.license_encryption_key.pub ä½¿ç”¨ cpæŒ‡ä»¤ å¤åˆ¶åˆ°è¯¥ç›®å½•ä¸‹ <strong>.&#x2F;gitlab&#x2F;.license_encryption_key.pub</strong></p></blockquote><h3 id="1-3-nginxåå‘ä»£ç†"><a href="#1-3-nginxåå‘ä»£ç†" class="headerlink" title="1.3 nginxåå‘ä»£ç†"></a>1.3 nginxåå‘ä»£ç†</h3><p>å‚è€ƒéƒ¨åˆ†é…ç½®ï¼ˆéœ€è¦è¡¥å…¨ï¼‰ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">  proxy_pass https://localhost:<span class="number">8443</span>;</span><br><span class="line">  proxy_set_header Host $host:$proxy_port;</span><br><span class="line">  proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">  proxy_set_header X-Forwarded-Host $http_host;</span><br><span class="line">  proxy_set_header X-Forwarded-Port $server_port;</span><br><span class="line">  proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">  proxy_http_version <span class="number">1.1</span>;</span><br><span class="line">  proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">  proxy_set_header Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">  proxy_redirect http:// https://;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4-å¯åŠ¨ä¸æ¿€æ´»"><a href="#1-4-å¯åŠ¨ä¸æ¿€æ´»" class="headerlink" title="1.4 å¯åŠ¨ä¸æ¿€æ´»"></a>1.4 å¯åŠ¨ä¸æ¿€æ´»</h3><ol><li><p>ä½¿ç”¨ docker-compose up -d è¿›è¡Œé•œåƒæ‹‰å–å’Œå¯åŠ¨</p></li><li><p>ä½¿ç”¨æŒ‡ä»¤è·å–å¯†ç  <code>sudo docker exec -it gitlab grep &#39;Password:&#39; /etc/gitlab/initial_root_password</code></p><p>ç™»å½•æ—¶ä½¿ç”¨ root ä¸ æ–¹æ‰è·å– password</p></li><li><p>å‰å¾€ <strong>${url}&#x2F;&#x2F;admin&#x2F;application_settings&#x2F;general</strong> è·¯å¾„ä¸‹ï¼Œ<code>æ·»åŠ è®¸å¯è¯</code>ä¸­æ‰‹åŠ¨è¾“å…¥<code>GitLabBV.gitlab-license</code>ä¸­å†…å®¹å¹¶æ¿€æ´»</p></li></ol><h2 id="2-å®‰è£…GitlabRunner"><a href="#2-å®‰è£…GitlabRunner" class="headerlink" title="2. å®‰è£…GitlabRunner"></a>2. å®‰è£…GitlabRunner</h2><p>å‚è€ƒé“¾æ¥ï¼š <a href="https://zhuanlan.zhihu.com/p/676184653#:\~:text=Ubuntu%2022.04%20%E7%B3%BB%E7%BB%9F%E4%B8%8A%E5%AE%89%E8%A3%85%20Gitlab%20Runner%201%201%29%20%E6%9B%B4%E6%96%B0,5%205%29%20%E5%A6%82%E4%BD%95%E5%9C%A8%20GitLab%20%E4%B8%8A%E6%B3%A8%E5%86%8C%20GitLab%20Runner%20%EF%BC%9F">https://zhuanlan.zhihu.com/p/676184653#:\~:text=Ubuntu%2022.04%20%E7%B3%BB%E7%BB%9F%E4%B8%8A%E5%AE%89%E8%A3%85%20Gitlab%20Runner%201%201%29%20%E6%9B%B4%E6%96%B0,5%205%29%20%E5%A6%82%E4%BD%95%E5%9C%A8%20GitLab%20%E4%B8%8A%E6%B3%A8%E5%86%8C%20GitLab%20Runner%20%EF%BC%9F</a></p><h3 id="2-1-æ·»åŠ æº"><a href="#2-1-æ·»åŠ æº" class="headerlink" title="2.1 æ·»åŠ æº"></a>2.1 æ·»åŠ æº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L <span class="string">&quot;https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh&quot;</span> | sudo bash</span><br></pre></td></tr></table></figure><h3 id="2-2-æ‰§è¡Œæ›´æ–°"><a href="#2-2-æ‰§è¡Œæ›´æ–°" class="headerlink" title="2.2 æ‰§è¡Œæ›´æ–°"></a>2.2 æ‰§è¡Œæ›´æ–°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br></pre></td></tr></table></figure><h3 id="2-3-ä¸‹è½½"><a href="#2-3-ä¸‹è½½" class="headerlink" title="2.3 ä¸‹è½½"></a>2.3 ä¸‹è½½</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install gitlab-runner</span><br></pre></td></tr></table></figure><h3 id="2-4-æ·»åŠ dockeræƒé™"><a href="#2-4-æ·»åŠ dockeræƒé™" class="headerlink" title="2.4 æ·»åŠ dockeræƒé™"></a>2.4 æ·»åŠ dockeræƒé™</h3><p>å‚è€ƒé“¾æ¥ï¼š <a href="https://blog.csdn.net/shancyr45/article/details/118441417">https://blog.csdn.net/shancyr45/article/details/118441417</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG docker gitlab-runner</span><br></pre></td></tr></table></figure><h2 id="3-é…ç½®é“¾æ¥GitlabRunner"><a href="#3-é…ç½®é“¾æ¥GitlabRunner" class="headerlink" title="3. é…ç½®é“¾æ¥GitlabRunner"></a>3. é…ç½®é“¾æ¥GitlabRunner</h2><ol><li>é€‰æ‹©ä¸€ä¸ªé¡¹ç›®</li><li>é€‰æ‹© <code>è®¾ç½®-CI/CD</code></li></ol><p><img src="https://upyun.akievergarden.top/blog/gitlab/d3c7bcff-44f9-4d2b-bf6e-bd1d18b987e9.png" alt="æ·»åŠ runner"></p><ol start="3"><li>ç‚¹å‡» <code>å±•å¼€</code></li><li>é€‰æ‹© <code>æ–°å»ºé¡¹ç›® runner</code> ï¼Œå¦‚ä¸‹å›¾</li></ol><p><img src="https://upyun.akievergarden.top/blog/gitlab/5052de0b-1c4a-4e8d-830a-fcf6532837cb.png" alt="æ·»åŠ runneré€‰é¡¹"></p><ol start="5"><li><p>å‚è€ƒ <a href="https://docs.gitlab.com/16.7/ee/ci/runners/configure_runners.html#use-tags-to-control-which-jobs-a-runner-can-run">https://docs.gitlab.com/16.7/ee/ci/runners/configure_runners.html#use-tags-to-control-which-jobs-a-runner-can-run</a> äº†è§£æ·»åŠ æ ‡ç­¾ä½œç”¨</p></li><li><p>ç‚¹å‡»æœ€ä¸‹æ–¹åˆ›å»ºrunner</p></li><li><p>æ ¹æ®æç¤ºå®Œæˆæ³¨å†Œ</p><p><img src="https://upyun.akievergarden.top/blog/gitlab/2b45fc4a-24f5-475a-ab66-53f725c8c435.png" alt="æ³¨å†Œ"></p></li></ol><blockquote><p>æ³¨æ„ï¼ï¼š gitlab-runner run å‘½ä»¤ä¼šåœ¨å½“å‰æŒ‡ä»¤ç›®å½•ä¸‹åˆ›å»º buildç›®å½•ï¼Œéœ€è¦ä¿®æ”¹ç›®å½•å¯ä»¥ç®€å•çš„åœ¨å…¶ä»–ç›®æ ‡ç›®å½•ä¸­æ‰§è¡Œè¯¥å‘½ä»¤  <code>gitlab-runner run</code> ã€‚å…¶ä»–æ–¹æ³•è¯·æŸ¥æ‰¾ gitlab-runner config.tomlï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™æ¡æŒ‡ä»¤å¯ä»¥ä¸æ‰§è¡Œï¼Œå› ä¸ºç¨‹åºé»˜è®¤æ‰§è¡Œ <code>/usr/bin/gitlab-runner run --working-directory /home/gitlab-runner --config /etc/gitlab-runner/config.toml --service gitlab-runner --user gitlab-runner</code>ï¼Œè¯¦æƒ…è§ <code>é¢å¤–å†…å®¹</code></p></blockquote><p><br>8. å®Œæˆåæ•ˆæœ</p><p>   <img src="https://upyun.akievergarden.top/blog/gitlab/feedd85f-ea9c-40a1-ba3a-26d3444a4b75.png" alt="æ•ˆæœ"></p><h2 id="4-åœ¨é¡¹ç›®ä¸­é…ç½®-gitlab-ci"><a href="#4-åœ¨é¡¹ç›®ä¸­é…ç½®-gitlab-ci" class="headerlink" title="4. åœ¨é¡¹ç›®ä¸­é…ç½®.gitlab.ci"></a>4. åœ¨é¡¹ç›®ä¸­é…ç½®.gitlab.ci</h2><p>å‚è€ƒé“¾æ¥ï¼š <a href="https://www.cnblogs.com/baoruizhe/p/16198309.html">https://www.cnblogs.com/baoruizhe/p/16198309.html</a></p><p>:::tip<br>å‰å¾€å®˜æ–¹æ–‡æ¡£è·å–æ›´å¤šä¿¡æ¯ï¼š <a href="https://docs.gitlab.com/16.7/ee/ci/yaml/index.html">https://docs.gitlab.com/16.7/ee/ci/yaml/index.html</a></p><p>:::</p><ol><li>é€‰æ‹©<code>æ„å»º-æµæ°´çº¿ç¼–è¾‘å™¨</code></li></ol><p><img src="https://upyun.akievergarden.top/blog/gitlab/f4425db1-57f3-49e9-a3fd-0297c8d27ea6.png" alt="é€‰æ‹©" title=" =1760x"></p><ol start="2"><li><p>é€‰æ‹©éœ€è¦è‡ªåŠ¨æ„å»ºçš„branch</p></li><li><p>å‚è€ƒå®˜æ–¹æ–‡æ¡£è¿›è¡Œç¼–å†™</p></li><li><p>å‚è€ƒæ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è„šæœ¬æ‰§è¡Œä¹‹ååˆ é™¤è¯¥é•œåƒï¼ˆä¸ºäº†ä¸ä¸ä¸‹æ¬¡é•œåƒæ‰“åŒ…å†²çªï¼‰</span></span><br><span class="line"><span class="attr">after_script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">docker</span> <span class="string">rmi</span> <span class="string">$(</span> <span class="string">docker</span> <span class="string">images</span> <span class="string">-q</span> <span class="string">-f</span> <span class="string">dangling=true)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰å‡ ä¸ªæµç¨‹ï¼ˆjobï¼‰ï¼Œè¿™é‡Œæ˜¯å®šä¹‰äº†ä¸‰ä¸ªè‡ªåŠ¨åŒ–æµç¨‹</span></span><br><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">job_build:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cd</span> <span class="string">./bbsbackend</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mvn</span> <span class="string">clean</span> <span class="string">install</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="attr">job_test:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cd</span> <span class="string">./bbsbackend</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mvn</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="attr">job_deploy:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">deploy</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cd</span> <span class="string">./bbsbackend</span></span><br><span class="line">    <span class="comment"># é€šè¿‡Dockerfileç”Ÿæˆé•œåƒ</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mvn</span> <span class="string">package</span> <span class="string">dockerfile:build</span></span><br><span class="line">    <span class="comment"># åˆ é™¤å·²ç»åœ¨è¿è¡Œçš„å®¹å™¨</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">if</span> [ <span class="string">$(docker</span> <span class="string">ps</span> <span class="string">-aq</span> <span class="string">--filter</span> <span class="string">name=bbsbackend)</span> ]<span class="string">;</span> <span class="string">then</span> <span class="string">docker</span> <span class="string">rm</span> <span class="string">-f</span> <span class="string">bbsbackend;fi</span></span><br><span class="line">    <span class="comment"># é€šè¿‡é•œåƒå¯åŠ¨å®¹å™¨ï¼Œå¹¶æŠŠæœ¬æœºç«¯å£æ˜ å°„åˆ°å®¹å™¨ç«¯å£</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docker</span> <span class="string">run</span> <span class="string">-d</span> <span class="string">-p</span> <span class="number">9090</span><span class="string">:9090</span> <span class="string">--name</span> <span class="string">bbsbackend</span> <span class="string">org.sevenstar/bbsbackend:0.0.1-SNAPSHOT</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">dev</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>é€‰æ‹©ä¸‹æ–¹æäº¤æ›´æ”¹ä»¥è§¦å‘è‡ªåŠ¨æ„å»º</p></li><li><p>ä»¥ä¸‹æ˜¯è‡ªåŠ¨æ„å»ºæ•ˆæœ</p><p><img src="https://upyun.akievergarden.top/blog/gitlab/6053190e-4979-4078-ac20-802ce7e8b3b7.png" alt="æ•ˆæœ"></p></li></ol><h2 id="5-é…ç½®è®¡åˆ’æ€§ä½œä¸š"><a href="#5-é…ç½®è®¡åˆ’æ€§ä½œä¸š" class="headerlink" title="5. é…ç½®è®¡åˆ’æ€§ä½œä¸š"></a>5. é…ç½®è®¡åˆ’æ€§ä½œä¸š</h2><p>å‰å¾€å›¾ä¸­ä½ç½®è¿›è¡Œåˆ›å»º</p><p><img src="https://upyun.akievergarden.top/blog/gitlab/5a7a1ffa-7d98-4c42-ae94-6a0201f30f09.png" alt="æ–°å»ºè®¡åˆ’"></p><h2 id="6-ï¼ˆå¯é€‰ï¼‰é…ç½®SMTP"><a href="#6-ï¼ˆå¯é€‰ï¼‰é…ç½®SMTP" class="headerlink" title="6. ï¼ˆå¯é€‰ï¼‰é…ç½®SMTP"></a>6. ï¼ˆå¯é€‰ï¼‰é…ç½®SMTP</h2><ol><li>å‰å¾€ç¼–è¾‘æŒ‚è½½æ–‡ä»¶ .&#x2F;gitlab&#x2F;config&#x2F;gitlab.rb</li><li>åœ¨ 80è¡Œå·¦å³ è¿›è¡Œç¼–è¾‘ï¼Œå‚è€ƒé“¾æ¥ï¼š <a href="https://blog.csdn.net/T748588330/article/details/79915074">https://blog.csdn.net/T748588330/article/details/79915074</a>&#x2F;</li></ol><p>\</p><h1 id="é¢å¤–å†…å®¹"><a href="#é¢å¤–å†…å®¹" class="headerlink" title="é¢å¤–å†…å®¹"></a>é¢å¤–å†…å®¹</h1><blockquote><p>éœ€è¦åœ¨gitlab.cliä¸­æ‰§è¡Œrootæƒé™æ“ä½œ</p></blockquote><p><a href="https://blog.csdn.net/white_pure/article/details/108039238">https://blog.csdn.net/white_pure/article/details/108039238</a></p><p>å®‰è£…gitlab-runneræ„å»ºæœºæ—¶é»˜è®¤ä¼šå°†ç”¨æˆ·è®¾ç½®ä¸ºï¼šgitlab-runnerï¼Œè¯¥è®¾ç½®ä¼šä½¿ç¼–å†™.gitlab-ci.ymlçš„è„šæœ¬ï¼Œæ“ä½œå¸¦æ¥ä¸€äº›æƒé™ä¸Šçš„é—®é¢˜ã€‚</p><p>ä¸ºäº†è§£å†³è¿™äº›æƒé™å¸¦æ¥çš„é—®é¢˜ï¼Œæˆ‘å°†gitlab-runneræ„å»ºæœºä¸Šçš„é»˜è®¤ç”¨æˆ·è®¾ç½®ä¸ºrootã€‚</p><p>è¯·æ³¨æ„ï¼š</p><blockquote><p>è¿™ç§æ–¹å¼è™½ç„¶ç®€å•ç²—æš´ï¼Œå½“ç„¶ä¹Ÿä¼šå¸¦æ¥ä¸€äº›å¼Šç«¯ï¼Œæ¯”å¦‚ï¼šé€šè¿‡.gitlab-ci.ymlè„šæœ¬è¿›è¡Œæ“ä½œæ–‡ä»¶ï¼ˆåˆ é™¤ã€ä¿®æ”¹æ—¶ï¼‰è¦æ ¼å¤–å°å¿ƒã€‚</p></blockquote><ul><li>é€šè¿‡ps aux|grep gitlab-runnerå‘½ä»¤æŸ¥çœ‹gitlab-runnerè¿›ç¨‹ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°gitlab-runnerçš„å·¥ä½œç›®å½•å’Œé»˜è®¤ç”¨æˆ·ç­‰ä¸€ç³»åˆ—ç›¸å…³ä¿¡æ¯ã€‚</li><li>é€šè¿‡è¯¥å‘½ä»¤sudo gitlab-runner uninstallå¯ä»¥å¸è½½æ‰gitlab-runneré»˜è®¤ç”¨æˆ·ã€‚</li><li>é‡æ–°å®‰è£…gitlab-runnerå¹¶å°†ç”¨æˆ·è®¾ç½®ä¸ºroot  gitlab-runner install â€“working-directory &#x2F;home&#x2F;gitlab-runner â€“user rootã€‚</li><li>sudo service gitlab-runner restarté‡å¯gitlab-runnerã€‚</li></ul><p>å†é€šè¿‡ç¬¬ä¸€æ­¥çš„å‘½ä»¤æŸ¥çœ‹gitlab-runnerçœ‹é»˜è®¤ç”¨æˆ·æ˜¯å¦å˜æˆrootã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ğŸ¤–-è‡ªåŠ¨åŒ–éƒ¨ç½²&quot;&gt;&lt;a href=&quot;#ğŸ¤–-è‡ªåŠ¨åŒ–éƒ¨ç½²&quot; class=&quot;headerlink&quot; title=&quot;ğŸ¤– è‡ªåŠ¨åŒ–éƒ¨ç½²&quot;&gt;&lt;/a&gt;ğŸ¤– è‡ªåŠ¨åŒ–éƒ¨ç½²&lt;/h1&gt;&lt;h1 id=&quot;æ‰§è¡Œè¿‡ç¨‹&quot;&gt;&lt;a href=&quot;#æ‰§è¡Œè¿‡ç¨‹&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="æŠ˜è…¾" scheme="https://blog.akievergarden.top/categories/%E6%8A%98%E8%85%BE/"/>
    
    
    <category term="gitlab" scheme="https://blog.akievergarden.top/tags/gitlab/"/>
    
  </entry>
  
  <entry>
    <title>Redisä¸»ä»éƒ¨ç½²æµ‹è¯•</title>
    <link href="https://blog.akievergarden.top/2023/11/19/Redis%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2%E6%B5%8B%E8%AF%95/"/>
    <id>https://blog.akievergarden.top/2023/11/19/Redis%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2%E6%B5%8B%E8%AF%95/</id>
    <published>2023-11-19T17:24:18.000Z</published>
    <updated>2024-03-20T12:59:53.194Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä½¿ç”¨-docker-redis-è¿›è¡Œä¸»ä»å¤åˆ¶æµ‹è¯•"><a href="#ä½¿ç”¨-docker-redis-è¿›è¡Œä¸»ä»å¤åˆ¶æµ‹è¯•" class="headerlink" title="ä½¿ç”¨ docker redis è¿›è¡Œä¸»ä»å¤åˆ¶æµ‹è¯•"></a>ä½¿ç”¨ docker redis è¿›è¡Œä¸»ä»å¤åˆ¶æµ‹è¯•</h1><h2 id="docker-compose-å®‰è£…redis"><a href="#docker-compose-å®‰è£…redis" class="headerlink" title="docker compose å®‰è£…redis"></a>docker compose å®‰è£…redis</h2><p>docker-compose å®‰è£… master</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:latest</span><br><span class="line">    container_name: redis-master</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&#x27;6001:6379&#x27;</span></span><br><span class="line">    volumes:</span><br><span class="line">      - ./data:/data</span><br><span class="line">      - ./redis.conf:/usr/local/etc/redis/redis.conf</span><br><span class="line">      - ./logs:/logs</span><br><span class="line">    <span class="comment">#é…ç½®æ–‡ä»¶å¯åŠ¨</span></span><br><span class="line">    <span class="built_in">command</span>: redis-server /usr/local/etc/redis/redis.conf</span><br></pre></td></tr></table></figure><p>confæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br></pre></td><td class="code"><pre><span class="line"># Redisé…ç½®æ–‡ä»¶æ ·ä¾‹</span><br><span class="line"> </span><br><span class="line"># å•ä½æ³¨æ„äº‹é¡¹ï¼šå½“éœ€è¦å†…å­˜å¤§å°æ—¶ï¼Œå¯ä»¥æŒ‡å®šï¼Œå®ƒä»¥é€šå¸¸çš„å½¢å¼ 1k 5GB 4M ç­‰ç­‰ï¼š</span><br><span class="line">#</span><br><span class="line"># 1k =&gt; 1000 bytes</span><br><span class="line"># 1kb =&gt; 1024 bytes</span><br><span class="line"># 1m =&gt; 1000000 bytes</span><br><span class="line"># 1mb =&gt; 1024*1024 bytes</span><br><span class="line"># 1g =&gt; 1000000000 bytes</span><br><span class="line"># 1gb =&gt; 1024*1024*1024 bytes</span><br><span class="line">#</span><br><span class="line"># å•ä½ä¸åŒºåˆ†å¤§å°å†™ï¼Œæ‰€ä»¥ 1GB 1Gb 1gB éƒ½æ˜¯ä¸€æ ·çš„</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">############################### INCLUDESï¼ˆåŒ…å«ï¼‰ ##############################</span><br><span class="line">#è¿™åœ¨ä½ æœ‰æ ‡å‡†é…ç½®æ¨¡æ¿ä½†æ˜¯æ¯ä¸ªredisæœåŠ¡å™¨åˆéœ€è¦ä¸ªæ€§è®¾ç½®çš„æ—¶å€™å¾ˆæœ‰ç”¨ã€‚ç­‰åŒimportå¯¼å…¥</span><br><span class="line"># include /path/to/local.conf</span><br><span class="line"># include /path/to/other.conf</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">############################## GENERALï¼ˆé€šé…ï¼‰##################################</span><br><span class="line"> </span><br><span class="line"># æ˜¯å¦åœ¨åå°æ‰§è¡Œï¼Œyesï¼šåå°è¿è¡Œï¼›noï¼šä¸æ˜¯åå°è¿è¡Œï¼ˆè€ç‰ˆæœ¬é»˜è®¤ï¼‰</span><br><span class="line">daemonize no</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># å½“Redisä»¥ä¸Šè¿°å®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œæ—¶ï¼ŒRedisé»˜è®¤ä¼šæŠŠè¿›ç¨‹æ–‡ä»¶å†™å…¥/var/run/redis.pidæ–‡ä»¶</span><br><span class="line">pidfile /var/run/redis.pid</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># æ˜¯å¦å¼€å¯ä¿æŠ¤æ¨¡å¼ã€‚å¦‚é…ç½®é‡Œæ²¡æœ‰æŒ‡å®šbindå’Œå¯†ç ã€‚å¼€å¯è¯¥å‚æ•°åï¼Œredisåªå…è®¸æœ¬åœ°è®¿é—®ï¼Œæ‹’ç»å¤–éƒ¨è®¿é—®</span><br><span class="line"># è¦æ˜¯å¼€å¯äº†å¯†ç å’Œbindï¼Œå¯ä»¥å¼€å¯ã€‚å¦åˆ™æœ€å¥½å…³é—­ï¼Œè®¾ç½®ä¸ºnoã€‚</span><br><span class="line">protected-mode no</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># Redisç›‘å¬ç«¯å£å·ï¼Œé»˜è®¤ä¸º6379ï¼Œå¦‚æœæŒ‡å®š0ç«¯å£ï¼Œè¡¨ç¤ºRedisä¸ç›‘å¬TCPè¿æ¥</span><br><span class="line">port 6379</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># åªå…è®¸æ¥è‡ªbindæŒ‡å®šç½‘å¡çš„Redisè¯·æ±‚ã€‚å¦‚æ²¡æœ‰æŒ‡å®šï¼Œåˆ™å¯ä»¥æ¥å—æ¥è‡ªä»»æ„ä¸€ä¸ªç½‘å¡çš„Redisè¯·æ±‚</span><br><span class="line"># bind 127.0.0.1</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">#é…ç½®unix socketæ¥è®©redisæ”¯æŒç›‘å¬æœ¬åœ°è¿æ¥ã€‚</span><br><span class="line"># unixsocket /var/run/redis/redis.sock</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">#é…ç½®unix socketä½¿ç”¨æ–‡ä»¶çš„æƒé™</span><br><span class="line"># unixsocketperm 755</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼›è¶…è¿‡timeoutï¼ŒæœåŠ¡ç«¯ä¼šæ–­å¼€è¿æ¥ï¼Œä¸º0åˆ™æœåŠ¡ç«¯ä¸ä¼šä¸»åŠ¨æ–­å¼€è¿æ¥ï¼Œä¸èƒ½å°äº0</span><br><span class="line">timeout 0</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># tcp keepaliveå‚æ•°ã€‚å¦‚æœè®¾ç½®ä¸ä¸º0ï¼Œå°±ä½¿ç”¨é…ç½®tcpçš„SO_KEEPALIVEå€¼</span><br><span class="line"># ä½¿ç”¨keepaliveæœ‰ä¸¤ä¸ªå¥½å¤„:</span><br><span class="line">#  1) æ£€æµ‹æŒ‚æ‰çš„å¯¹ç«¯ã€‚é™ä½ä¸­é—´è®¾å¤‡å‡ºé—®é¢˜è€Œå¯¼è‡´ç½‘ç»œçœ‹ä¼¼è¿æ¥å´å·²ç»ä¸å¯¹ç«¯ç«¯å£çš„é—®é¢˜ã€‚</span><br><span class="line">#  2) åœ¨Linuxå†…æ ¸ä¸­ï¼Œè®¾ç½®äº†keepaliveï¼Œredisä¼šå®šæ—¶ç»™å¯¹ç«¯å‘é€ackã€‚æ£€æµ‹åˆ°å¯¹ç«¯å…³é—­éœ€ä¸¤å€çš„è®¾ç½®å€¼</span><br><span class="line">tcp-keepalive 0</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># æŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«ï¼Œå››ä¸ªçº§åˆ«ï¼š</span><br><span class="line"># 1) debugï¼šå¾ˆå¤šä¿¡æ¯ï¼Œæ–¹ä¾¿å¼€å‘ã€æµ‹è¯•</span><br><span class="line"># 2) verboseï¼šè®¸å¤šæœ‰ç”¨çš„ä¿¡æ¯ï¼Œä½†æ˜¯æ²¡æœ‰debugçº§åˆ«ä¿¡æ¯å¤šï¼ˆé»˜è®¤ï¼‰</span><br><span class="line"># 3) noticeï¼šé€‚å½“çš„æ—¥å¿—çº§åˆ«ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ</span><br><span class="line"># 4) warningï¼šåªè®°å½•éå¸¸é‡è¦/å…³é”®çš„æ¶ˆæ¯</span><br><span class="line">loglevel verbose</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># æŒ‡å®šæ—¥å¿—æ–‡ä»¶è®°å½•çš„ä½ç½®ã€‚logfile â€œâ€ï¼šæ ‡å‡†è¾“å‡ºã€‚åˆ™æ—¥å¿—å°†ä¼šå‘é€ç»™/dev/null</span><br><span class="line">logfile â€œâ€  </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># æ˜¯å¦å°†æ—¥å¿—è¾“å‡ºåˆ°ç³»ç»Ÿæ—¥å¿—</span><br><span class="line"># syslog-enabled no</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># syslogçš„æ ‡è¯†ç¬¦ã€‚</span><br><span class="line"># syslog-ident redis</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># æ—¥å¿—çš„æ¥æºã€è®¾å¤‡ï¼›æŒ‡å®šç³»ç»Ÿæ—¥å¿—å·¥å…·ã€‚å¿…é¡»æ˜¯ USER æˆ–ä»‹äº LOCAL0-LOCAL7 ä¹‹é—´</span><br><span class="line"># syslog-facility local0</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># æ•°æ®åº“çš„æ•°é‡ï¼Œé»˜è®¤æ•°æ®åº“ä¸º0ã€‚å¯é€šè¿‡â€SELECT [index]â€œå‘½ä»¤æŒ‡å®šæ•°æ®åº“</span><br><span class="line">databases 16</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">########################### SNAPSHOTTING (å¿«ç…§æ–¹å¼)  ###########################</span><br><span class="line"> </span><br><span class="line"># æŒ‡å®šåœ¨å¤šé•¿æ—¶é—´å†…ï¼Œæœ‰å¤šå°‘æ¬¡æ›´æ–°æ“ä½œï¼Œå°±å°†æ•°æ®åŒæ­¥åˆ°æ•°æ®æ–‡ä»¶ï¼Œå¯ä»¥å¤šä¸ªæ¡ä»¶é…åˆ</span><br><span class="line"># æ³¨é‡Šæ‰â€œsaveâ€è¿™ä¸€è¡Œé…ç½®é¡¹å°±å¯ä»¥è®©ä¿å­˜æ•°æ®åº“åŠŸèƒ½å¤±æ•ˆ</span><br><span class="line"># 900ç§’ï¼ˆ15åˆ†é’Ÿï¼‰å†…è‡³å°‘1ä¸ªkeyå€¼æ”¹å˜ï¼ˆåˆ™è¿›è¡Œæ•°æ®åº“ä¿å­˜--æŒä¹…åŒ–ï¼‰ </span><br><span class="line"># 300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰å†…è‡³å°‘10ä¸ªkeyå€¼æ”¹å˜ï¼ˆåˆ™è¿›è¡Œæ•°æ®åº“ä¿å­˜--æŒä¹…åŒ–ï¼‰ </span><br><span class="line"># 60ç§’ï¼ˆ1åˆ†é’Ÿï¼‰å†…è‡³å°‘10000ä¸ªkeyå€¼æ”¹å˜ï¼ˆåˆ™è¿›è¡Œæ•°æ®åº“ä¿å­˜--æŒä¹…åŒ–ï¼‰</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># å½“RDBæŒä¹…åŒ–å‡ºç°é”™è¯¯åï¼Œæ˜¯å¦ä¾ç„¶è¿›è¡Œç»§ç»­è¿›è¡Œå·¥ä½œï¼Œyesï¼šä¸èƒ½è¿›è¡Œå·¥ä½œï¼Œnoï¼šå¯ä»¥ç»§ç»­è¿›è¡Œå·¥ä½œ</span><br><span class="line"># å¯ä»¥é€šè¿‡infoä¸­çš„rdb_last_bgsave_statusäº†è§£RDBæŒä¹…åŒ–æ˜¯å¦æœ‰é”™è¯¯</span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># æŒ‡å®šå­˜å‚¨è‡³æœ¬åœ°æ•°æ®åº“æ—¶æ˜¯å¦å‹ç¼©æ•°æ®ï¼Œè€—cpuèµ„æºï¼Œé»˜è®¤ä¸ºyesï¼ŒRedisé‡‡ç”¨LZFå‹ç¼©</span><br><span class="line"># å¦‚æœä¸ºäº†èŠ‚çœCPUæ—¶é—´ï¼Œå¯ä»¥å…³é—­è¯¥é€‰é¡¹ï¼Œä½†ä¼šå¯¼è‡´æ•°æ®åº“æ–‡ä»¶å˜çš„å·¨å¤§</span><br><span class="line">rdbcompression yes</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># ä¿å­˜rdbæ–‡ä»¶æ—¶ï¼Œæ˜¯å¦è¿›è¡Œé”™è¯¯æ£€æŸ¥æ ¡éªŒã€‚</span><br><span class="line"># ä»rdbæ ¼å¼çš„ç¬¬äº”ä¸ªç‰ˆæœ¬å¼€å§‹ï¼Œåœ¨rdbæ–‡ä»¶çš„æœ«å°¾ä¼šå¸¦ä¸ŠCRC64çš„æ ¡éªŒå’Œã€‚è¿™è·Ÿæœ‰åˆ©äºæ–‡ä»¶çš„å®¹é”™æ€§</span><br><span class="line"># ä½†æ˜¯åœ¨ä¿å­˜rdbæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šæœ‰å¤§æ¦‚10%çš„æ€§èƒ½æŸè€—ï¼Œå¦‚æœä½ è¿½æ±‚é«˜æ€§èƒ½ï¼Œå¯ä»¥å…³é—­è¯¥é…ç½®ã€‚</span><br><span class="line">rdbchecksum yes</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># æŒ‡å®šæœ¬åœ°æ•°æ®åº“æ–‡ä»¶åï¼ˆrdbæ–‡ä»¶çš„åç§°ï¼‰ï¼Œé»˜è®¤å€¼ä¸ºdump.rdb</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># æ•°æ®ç›®å½•ï¼Œæ•°æ®åº“çš„å†™å…¥ä¼šåœ¨è¿™ä¸ªç›®å½•ã€‚rdbã€aofæ–‡ä»¶ä¹Ÿä¼šå†™åœ¨è¿™ä¸ªç›®å½•</span><br><span class="line"># æŒ‡å®šæœ¬åœ°æ•°æ®åº“å­˜æ”¾ç›®å½•ï¼ˆdump.rdbæ–‡ä»¶å­˜æ”¾ç›®å½•ï¼‰ï¼Œrdbã€aofæ–‡ä»¶ä¹Ÿä¼šå†™åœ¨è¿™ä¸ªç›®å½•</span><br><span class="line"># æ³¨æ„ï¼Œè¿™é‡Œåªèƒ½æŒ‡å®šä¸€ä¸ªç›®å½•ï¼Œä¸èƒ½æŒ‡å®šæ–‡ä»¶åï¼ˆæ–‡ä»¶åç”±ä¸Šä¸€ä¸ªdbfilenameé…ç½®é¡¹æŒ‡å®šï¼‰</span><br><span class="line">dir ./</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">############################# REPLICATIONï¼ˆä¸»ä»å¤åˆ¶ï¼‰ #############################</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># ä¸»ä»å¤åˆ¶ã€‚ä½¿ç”¨slaveofä» RedisæœåŠ¡å™¨å¤åˆ¶ä¸€ä¸ªRediså®ä¾‹ã€‚æ³¨æ„ï¼Œè¯¥é…ç½®ä»…é™äºå½“å‰slaveæœ‰æ•ˆ</span><br><span class="line"># è®¾ç½®å½“æœ¬æœºä¸ºslavæœåŠ¡æ—¶ï¼Œè®¾ç½®masteræœåŠ¡çš„ipåœ°å€åŠç«¯å£ï¼ŒRediså¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨ä»masterè¿›è¡Œæ•°æ®åŒæ­¥</span><br><span class="line"># slaveof &lt;masterip&gt; &lt;masterport&gt;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># å¦‚masterè®¾ç½®äº†requirepasså¯†ç ï¼Œslaveç”¨æ­¤é€‰é¡¹æŒ‡å®šmasterè®¤è¯å¯†ç </span><br><span class="line"># ä¸‹æ–‡çš„â€œrequirepassâ€é…ç½®é¡¹å¯ä»¥æŒ‡å®šå¯†ç </span><br><span class="line"># masterauth &lt;master-password&gt;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># ä»åº“åŒä¸»æœºå¤±å»è¿æ¥æˆ–è€…å¤åˆ¶æ­£åœ¨è¿›è¡Œï¼Œä»æœºåº“çš„ä¸¤ç§è¿è¡Œæ–¹å¼</span><br><span class="line"># å½“slaveä¸masterä¹‹é—´çš„è¿æ¥æ–­å¼€æˆ–slaveæ­£åœ¨ä¸masterè¿›è¡Œæ•°æ®åŒæ­¥æ—¶ï¼Œå¦‚æœæœ‰slaveè¯·æ±‚</span><br><span class="line"># 1) yesï¼šslaveä»ç„¶å“åº”è¯·æ±‚ï¼Œæ­¤æ—¶å¯èƒ½æœ‰é—®é¢˜</span><br><span class="line"># 2) noï¼šslaveä¼šè¿”å›&quot;SYNC with master in progress&quot;é”™è¯¯ä¿¡æ¯ã€‚ä½†INFOå’ŒSLAVEOFå‘½ä»¤é™¤å¤–ã€‚</span><br><span class="line">slave-serve-stale-data yes</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># ä½œä¸ºä»æœåŠ¡å™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯åªè¯»çš„ï¼ˆyesï¼‰ï¼Œå¯ä»¥ä¿®æ”¹æˆNOï¼Œç”¨äºå†™ï¼ˆä¸å»ºè®®ï¼‰ã€‚</span><br><span class="line">slave-read-only yes</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># æ˜¯å¦ä½¿ç”¨socketæ–¹å¼å¤åˆ¶æ•°æ®ã€‚ç›®å‰rediså¤åˆ¶æä¾›ä¸¤ç§æ–¹å¼ï¼Œdiskå’Œsocketã€‚å¦‚æœæ–°çš„slaveè¿ä¸Šæ¥æˆ–# è€…é‡è¿çš„slaveæ— æ³•éƒ¨åˆ†åŒæ­¥ï¼Œå°±ä¼šæ‰§è¡Œå…¨é‡åŒæ­¥ï¼Œmasterä¼šç”Ÿæˆrdbæ–‡ä»¶ã€‚</span><br><span class="line"># æœ‰2ç§æ–¹å¼ï¼š</span><br><span class="line">#   1) diskï¼šmasteråˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹æŠŠrdbæ–‡ä»¶ä¿å­˜åˆ°ç£ç›˜ï¼Œå†æŠŠç£ç›˜ä¸Šçš„rdbæ–‡ä»¶ä¼ é€’ç»™slaveã€‚</span><br><span class="line">#   2) socketï¼šmasteråˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œç›´æ¥æŠŠrdbæ–‡ä»¶ä»¥socketçš„æ–¹å¼å‘ç»™slaveã€‚</span><br><span class="line"># diskæ–¹å¼æ—¶ï¼Œå½“ä¸€ä¸ªrdbä¿å­˜çš„è¿‡ç¨‹ä¸­ï¼Œå¤šä¸ªslaveéƒ½èƒ½å…±äº«è¿™ä¸ªrdbæ–‡ä»¶ã€‚</span><br><span class="line"># socketæ–¹å¼å°±å¾—ä¸€ä¸ªä¸ªslaveé¡ºåºå¤åˆ¶ã€‚åœ¨ç£ç›˜é€Ÿåº¦ç¼“æ…¢ï¼Œç½‘é€Ÿå¿«çš„æƒ…å†µä¸‹æ¨èç”¨socketæ–¹å¼ã€‚</span><br><span class="line">repl-diskless-sync no</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># disklesså¤åˆ¶çš„å»¶è¿Ÿæ—¶é—´ï¼Œé˜²æ­¢è®¾ç½®ä¸º0ã€‚ä¸€æ—¦å¤åˆ¶å¼€å§‹</span><br><span class="line"># èŠ‚ç‚¹ä¸ä¼šå†æ¥æ”¶æ–°slaveçš„å¤åˆ¶è¯·æ±‚ç›´åˆ°ä¸‹ä¸€ä¸ªrdbä¼ è¾“ã€‚æ‰€ä»¥æœ€å¥½ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç­‰æ›´å¤šçš„slaveè¿ä¸Šæ¥</span><br><span class="line">repl-diskless-sync-delay 5</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># slaveæ ¹æ®æŒ‡å®šçš„æ—¶é—´é—´éš”å‘æœåŠ¡å™¨å‘é€pingè¯·æ±‚ã€‚é»˜è®¤10ç§’ã€‚</span><br><span class="line"># repl-ping-slave-period 10</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># å¤åˆ¶è¿æ¥è¶…æ—¶æ—¶é—´ã€‚masterå’Œslaveéƒ½æœ‰è¶…æ—¶æ—¶é—´çš„è®¾ç½®ã€‚</span><br><span class="line"># masteræ£€æµ‹åˆ°slaveä¸Šæ¬¡å‘é€çš„æ—¶é—´è¶…è¿‡repl-timeoutï¼Œå³è®¤ä¸ºslaveç¦»çº¿ï¼Œæ¸…é™¤è¯¥slaveä¿¡æ¯ã€‚</span><br><span class="line"># slaveæ£€æµ‹åˆ°ä¸Šæ¬¡å’Œmasteräº¤äº’çš„æ—¶é—´è¶…è¿‡repl-timeoutï¼Œåˆ™è®¤ä¸ºmasterç¦»çº¿ã€‚</span><br><span class="line"># éœ€æ³¨æ„repl-timeoutéœ€è®¾ç½®ä¸€ä¸ªæ¯”repl-ping-slave-periodæ›´å¤§çš„å€¼ï¼Œä¸ç„¶ä¼šç»å¸¸æ£€æµ‹åˆ°è¶…æ—¶ã€‚</span><br><span class="line"># repl-timeout 60</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># æ˜¯å¦ç¦æ­¢å¤åˆ¶tcpé“¾æ¥çš„tcp nodelayå‚æ•°ï¼Œé»˜è®¤æ˜¯noï¼Œå³ä½¿ç”¨tcp nodelayã€‚</span><br><span class="line"># å¦‚masterè®¾ç½®äº†yesï¼Œåœ¨æŠŠæ•°æ®å¤åˆ¶ç»™slaveæ—¶ï¼Œä¼šå‡å°‘åŒ…çš„æ•°é‡å’Œæ›´å°çš„ç½‘ç»œå¸¦å®½ã€‚</span><br><span class="line"># ä½†è¿™ä¹Ÿå¯èƒ½å¸¦æ¥æ•°æ®çš„å»¶è¿Ÿã€‚é»˜è®¤æˆ‘ä»¬æ¨èæ›´å°çš„å»¶è¿Ÿï¼Œä½†åœ¨æ•°æ®é‡ä¼ è¾“å¾ˆå¤§çš„åœºæ™¯ä¸‹ï¼Œå»ºè®®é€‰æ‹©yesã€‚</span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># å¤åˆ¶ç¼“å†²åŒºå¤§å°ï¼Œè¿™æ˜¯ä¸€ä¸ªç¯å½¢å¤åˆ¶ç¼“å†²åŒºï¼Œç”¨æ¥ä¿å­˜æœ€æ–°å¤åˆ¶çš„å‘½ä»¤ã€‚</span><br><span class="line"># è¿™æ ·åœ¨slaveç¦»çº¿æ—¶ï¼Œæ— éœ€å®Œå…¨å¤åˆ¶masterçš„æ•°æ®ï¼Œå¦‚æœå¯ä»¥æ‰§è¡Œéƒ¨åˆ†åŒæ­¥ï¼Œåªéœ€æŠŠç¼“å†²åŒºçš„éƒ¨åˆ†æ•°æ®å¤åˆ¶# ç»™slaveï¼Œå°±èƒ½æ¢å¤æ­£å¸¸å¤åˆ¶çŠ¶æ€ã€‚ç¼“å†²åŒºçš„å¤§å°è¶Šå¤§ï¼Œslaveç¦»çº¿çš„æ—¶é—´å¯ä»¥æ›´é•¿ï¼Œå¤åˆ¶ç¼“å†²åŒºåªæœ‰åœ¨æœ‰</span><br><span class="line"># slaveè¿æ¥çš„æ—¶å€™æ‰åˆ†é…å†…å­˜ã€‚æ²¡æœ‰slaveçš„ä¸€æ®µæ—¶é—´ï¼Œå†…å­˜ä¼šè¢«é‡Šæ”¾å‡ºæ¥ï¼Œé»˜è®¤1mã€‚</span><br><span class="line"># repl-backlog-size 5mb</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># masteræ²¡æœ‰slaveä¸€æ®µæ—¶é—´ä¼šé‡Šæ”¾å¤åˆ¶ç¼“å†²åŒºçš„å†…å­˜ï¼Œrepl-backlog-ttlè®¾ç½®è¯¥æ—¶é—´é•¿åº¦ã€‚å•ä½ä¸ºç§’</span><br><span class="line"># repl-backlog-ttl 3600</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># å½“masterä¸å¯ç”¨ï¼ŒSentinelä¼šæ ¹æ®slaveçš„ä¼˜å…ˆçº§é€‰ä¸¾ä¸€ä¸ªmasterã€‚</span><br><span class="line"># æœ€ä½çš„ä¼˜å…ˆçº§çš„slaveï¼Œå½“é€‰masterã€‚è€Œé…ç½®æˆ0ï¼Œæ°¸è¿œä¸ä¼šè¢«é€‰ä¸¾ã€‚</span><br><span class="line">slave-priority 100</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># masteråœæ­¢å†™å…¥çš„æ–¹å¼ï¼Œå¥åº·çš„slaveçš„ä¸ªæ•°å°äºNï¼Œmaterå°±ç¦æ­¢å†™å…¥ã€‚masteræœ€å°‘å¾—æœ‰å¤šå°‘ä¸ªå¥åº·çš„</span><br><span class="line"># slaveå­˜æ´»æ‰èƒ½æ‰§è¡Œå†™å‘½ä»¤ã€‚è¿™ä¸ªé…ç½®è™½ç„¶ä¸èƒ½ä¿è¯Nä¸ªslaveéƒ½ä¸€å®šèƒ½æ¥æ”¶åˆ°masterçš„å†™æ“ä½œï¼Œ</span><br><span class="line"># ä½†èƒ½é¿å…æ²¡æœ‰è¶³å¤Ÿå¥åº·çš„slaveæ—¶ï¼Œmasterä¸èƒ½å†™å…¥æ¥é¿å…æ•°æ®ä¸¢å¤±ã€‚è®¾ç½®ä¸º0æ˜¯å…³é—­è¯¥åŠŸèƒ½ã€‚</span><br><span class="line"># min-slaves-to-write 3</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># å»¶è¿Ÿå°äºmin-slaves-max-lag ç§’çš„slaveæ‰è®¤ä¸ºæ˜¯å¥åº·çš„slaveã€‚</span><br><span class="line"># min-slaves-max-lag 10</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">############################## SECURITYï¼ˆå®‰å…¨ï¼‰ ################################</span><br><span class="line"> </span><br><span class="line"># é…ç½®redisè¿æ¥è®¤è¯å¯†ç </span><br><span class="line"># å¦‚æœé…ç½®äº†ï¼Œåˆ™å®¢æˆ·ç«¯åœ¨è¿æ¥Redisæ—¶éœ€é€šè¿‡auth &lt;password&gt;å‘½ä»¤æä¾›å¯†ç ï¼ˆé»˜è®¤å…³é—­ï¼‰</span><br><span class="line"># æ³¨æ„ï¼šå› ä¸ºrediså¤ªå¿«äº†ï¼Œæ¯ç§’å¯è®¤è¯15wæ¬¡å¯†ç ï¼Œç®€å•çš„å¾ˆå®¹æ˜“è¢«æ”»ç ´ï¼Œæœ€å¥½ä½¿ç”¨ä¸€ä¸ªæ›´å¤æ‚çš„å¯†ç </span><br><span class="line"># requirepass 114514!!!</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># æŠŠå±é™©çš„å‘½ä»¤ç»™ä¿®æ”¹æˆå…¶ä»–åç§°ã€‚æ¯”å¦‚CONFIGå‘½ä»¤å¯ä»¥é‡å‘½åä¸ºä¸€ä¸ªå¾ˆéš¾è¢«çŒœåˆ°çš„å‘½ä»¤</span><br><span class="line"># è¿™æ ·ç”¨æˆ·ä¸èƒ½ä½¿ç”¨ï¼Œè€Œå†…éƒ¨å·¥å…·è¿˜èƒ½æ¥ç€ä½¿ç”¨ã€‚</span><br><span class="line"># rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># è®¾ç½®æˆä¸€ä¸ªç©ºçš„å€¼ï¼Œå¯ä»¥ç¦æ­¢ä¸€ä¸ªå‘½ä»¤</span><br><span class="line"># rename-command CONFIG &quot;&quot;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">################################ LIMITSï¼ˆé™åˆ¶ï¼‰#################################</span><br><span class="line"> </span><br><span class="line"># è®¾ç½®è¿ä¸Šredisçš„æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°é‡ã€‚é»˜è®¤10000ã€‚è®¾ç½®0è¡¨ç¤ºä¸ä½œé™åˆ¶ã€‚</span><br><span class="line"># è¶…å‡ºæ­¤æ•°ï¼ŒRedisä¼šå…³é—­æ–°çš„è¿æ¥å¹¶å‘å®¢æˆ·ç«¯è¿”å›max Number of clients reachedé”™è¯¯</span><br><span class="line"># redisä¸åŒºåˆ†è¿æ¥æ˜¯å®¢æˆ·ç«¯è¿æ¥è¿˜æ˜¯å†…éƒ¨æ‰“å¼€æ–‡ä»¶æˆ–å’Œslaveè¿æ¥ç­‰ï¼Œæ•…maxclientsæœ€å°å»ºè®®è®¾ç½®åˆ°32</span><br><span class="line"># maxclients 10000</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># æŒ‡å®šRedisæœ€å¤§å†…å­˜é™åˆ¶ï¼ŒRedisåœ¨å¯åŠ¨æ—¶ä¼šæŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­</span><br><span class="line"># å½“å†…å­˜æ»¡äº†ï¼Œé…åˆmaxmemory-policyç­–ç•¥è¿›è¡Œå¤„ç†</span><br><span class="line"># å½“æ­¤æ–¹æ³•å¤„ç†åï¼Œä»ç„¶åˆ°è¾¾æœ€å¤§å†…å­˜è®¾ç½®ï¼Œå°†æ— æ³•å†è¿›è¡Œå†™å…¥æ“ä½œï¼Œä½†ä»ç„¶å¯ä»¥è¿›è¡Œè¯»å–æ“ä½œã€‚</span><br><span class="line"># maxmemory &lt;bytes&gt;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># å†…å­˜å®¹é‡è¶…è¿‡maxmemoryåçš„å¤„ç†ç­–ç•¥å¦‚ä¸‹å‡ ç§ç­–ç•¥ï¼š</span><br><span class="line">#  1) volatile-lruï¼šåªå¯¹è®¾ç½®è¿‡æœŸæ—¶é—´çš„keyè¿›è¡ŒLRUç®—æ³•åˆ é™¤ï¼ˆé»˜è®¤ï¼‰</span><br><span class="line">#  2) allkeys-lruï¼šåˆ é™¤ä¸ç»å¸¸ä½¿ç”¨çš„key</span><br><span class="line">#  3) volatile-randomï¼šéšæœºåˆ é™¤å³å°†è¿‡æœŸçš„key</span><br><span class="line">#  4) allkeys-&gt;randomï¼šéšæœºåˆ é™¤ä¸€ä¸ªkey</span><br><span class="line">#  5) volatile-ttlï¼šåˆ é™¤å³å°†è¿‡æœŸçš„çš„key</span><br><span class="line">#  6) noevictionï¼šä¸ç§»é™¤ä»»ä½•keyï¼Œå¯¹äºå†™å‘½ä»¤è¿”å›æŠ¥é”™</span><br><span class="line"># maxmemory-policy volatile-lru</span><br><span class="line"> </span><br><span class="line">#</span><br><span class="line"> </span><br><span class="line"># lruæ£€æµ‹çš„æ ·æœ¬æ•°ã€‚</span><br><span class="line"># ä½¿ç”¨lruæˆ–ttlæ·˜æ±°ç®—æ³•ï¼Œä»éœ€è¦æ·˜æ±°çš„åˆ—è¡¨ä¸­éšæœºé€‰æ‹©sampleä¸ªkeyï¼Œé€‰å‡ºé—²ç½®æ—¶é—´æœ€é•¿çš„keyç§»é™¤ã€‚</span><br><span class="line"># maxmemory-samples 3</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">########################## APPEND ONLY MODE ï¼ˆé™„åŠ æ¨¡å¼ï¼‰ ###########################</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># AOFæŒä¹…åŒ–ï¼ŒæŒ‡å®šæ˜¯å¦åœ¨æ¯æ¬¡æ›´æ–°æ“ä½œåè¿›è¡Œæ—¥å¿—è®°å½•ï¼Œé»˜è®¤redisæ˜¯å¼‚æ­¥ï¼ˆå¿«ç…§ï¼‰çš„æŠŠæ•°æ®å†™å…¥æœ¬åœ°ç£ç›˜</span><br><span class="line"># redisé»˜è®¤ä½¿ç”¨çš„æ˜¯rdbæ–¹å¼æŒä¹…åŒ–ï¼Œæ­¤æ–¹å¼åœ¨è®¸å¤šåº”ç”¨ä¸­å·²è¶³å¤Ÿç”¨ã€‚</span><br><span class="line"># ä½†rediså¦‚æœä¸­é€”å®•æœºï¼Œä¼šå¯¼è‡´å¯èƒ½æœ‰å‡ åˆ†é’Ÿçš„æ•°æ®ä¸¢å¤±ï¼ŒæŒ‰ç…§ä¸Šé¢saveæ¡ä»¶æ¥ç­–ç•¥è¿›è¡ŒæŒä¹…åŒ–</span><br><span class="line"># Append Only Fileæ˜¯å¦ä¸€ç§æŒä¹…åŒ–æ–¹å¼ï¼Œå¯æä¾›æ›´å¥½çš„æŒä¹…åŒ–ç‰¹æ€§ã€‚</span><br><span class="line"># Redisä¼šæŠŠæ¯æ¬¡å†™å…¥çš„æ•°æ®åœ¨æ¥æ”¶åéƒ½å†™å…¥appendonly.aof æ–‡ä»¶</span><br><span class="line"># æ¯æ¬¡å¯åŠ¨æ—¶Rediséƒ½ä¼šå…ˆæŠŠè¿™ä¸ªæ–‡ä»¶çš„æ•°æ®è¯»å…¥å†…å­˜é‡Œï¼Œå…ˆå¿½ç•¥RDBæ–‡ä»¶ã€‚</span><br><span class="line">appendonly no</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># æŒ‡å®šaofæ–‡ä»¶åï¼Œé»˜è®¤ä¸ºappendonly.aof</span><br><span class="line"># appendfilename appendonly.aof</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># AOFæŒä¹…åŒ–ä¸‰ç§åŒæ­¥ç­–ç•¥ï¼š</span><br><span class="line">#   1) noï¼šä¸åŒæ­¥ï¼ˆä¸æ‰§è¡Œfsyncï¼‰ï¼Œæ•°æ®ä¸ä¼šæŒä¹…åŒ–</span><br><span class="line">#   2) alwaysï¼šæ¯æ¬¡æœ‰æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶éƒ½ä¼šå†™å…¥appendonly.aofï¼ˆæ…¢ï¼Œå®‰å…¨ï¼‰</span><br><span class="line">#   3) everysecï¼šæ¯ç§’åŒæ­¥ä¸€æ¬¡åˆ°appendonly.aofï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸¢å¤±è¿™1sæ•°æ®ï¼ˆæŠ˜ä¸­é€‰æ‹©ï¼Œé»˜è®¤å€¼ï¼‰</span><br><span class="line">appendfsync everysec</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># åœ¨AOFé‡å†™æˆ–å†™å…¥rdbæ–‡ä»¶æ—¶ï¼Œä¼šæ‰§è¡Œå¤§é‡IO</span><br><span class="line"># å¯¹äºeverysecå’Œalwaysçš„AOFæ¨¡å¼æ¥è¯´ï¼Œæ‰§è¡Œfsyncä¼šé€ æˆé˜»å¡è¿‡é•¿æ—¶é—´</span><br><span class="line"># yesï¼šè¡¨ç¤ºrewriteæœŸé—´å¯¹æ–°å†™æ“ä½œä¸fsync,æš‚æ—¶å­˜åœ¨å†…å­˜ä¸­,ç­‰rewriteå®Œæˆåå†å†™å…¥</span><br><span class="line"># é»˜è®¤ä¸ºnoï¼Œå»ºè®®yesã€‚Linuxçš„é»˜è®¤fsyncç­–ç•¥æ˜¯30ç§’ã€‚å¯èƒ½ä¸¢å¤±30ç§’æ•°æ®ã€‚</span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># AOFè‡ªåŠ¨é‡å†™é…ç½®ã€‚å½“ç›®å‰AOFæ–‡ä»¶å¤§å°è¶…è¿‡ä¸Šä¸€æ¬¡é‡å†™çš„aofæ–‡ä»¶å¤§å°çš„ç™¾åˆ†ä¹‹å¤šå°‘è¿›è¡Œé‡å†™</span><br><span class="line"># å³å½“AOFæ–‡ä»¶å¢é•¿åˆ°ä¸€å®šå¤§å°æ—¶ï¼ŒRedisèƒ½è°ƒç”¨bgrewriteaofå¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œé‡å†™ã€‚</span><br><span class="line"># å½“å‰AOFæ–‡ä»¶å¤§å°æ˜¯ä¸Šæ¬¡æ—¥å¿—é‡å†™å¾—åˆ°AOFæ–‡ä»¶å¤§å°çš„äºŒå€ï¼ˆè®¾ç½®ä¸º100ï¼‰æ—¶ï¼Œè‡ªåŠ¨å¯åŠ¨æ–°çš„æ—¥å¿—é‡å†™è¿‡ç¨‹ã€‚</span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># è®¾ç½®å…è®¸é‡å†™çš„æœ€å°AOFæ–‡ä»¶å¤§å°ï¼Œé¿å…äº†è¾¾åˆ°çº¦å®šç™¾åˆ†æ¯”ä½†å°ºå¯¸ä»ç„¶å¾ˆå°çš„æƒ…å†µè¿˜è¦é‡å†™</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">#aofæ–‡ä»¶å¯èƒ½åœ¨å°¾éƒ¨æ˜¯ä¸å®Œæ•´çš„ï¼Œå½“rediså¯åŠ¨çš„æ—¶å€™ï¼Œaofæ–‡ä»¶çš„æ•°æ®è¢«è½½å…¥å†…å­˜ã€‚é‡å¯å¯èƒ½å‘ç”Ÿåœ¨redisæ‰€åœ¨çš„ä¸»æœºæ“ä½œç³»ç»Ÿå®•æœºåï¼Œå°¤å…¶åœ¨ext4æ–‡ä»¶ç³»ç»Ÿæ²¡æœ‰åŠ ä¸Šdata=orderedé€‰é¡¹ï¼ˆrediså®•æœºæˆ–è€…å¼‚å¸¸ç»ˆæ­¢ä¸ä¼šé€ æˆå°¾éƒ¨ä¸å®Œæ•´ç°è±¡ã€‚ï¼‰å‡ºç°è¿™ç§ç°è±¡ï¼Œå¯ä»¥é€‰æ‹©è®©redisé€€å‡ºï¼Œæˆ–è€…å¯¼å…¥å°½å¯èƒ½å¤šçš„æ•°æ®ã€‚å¦‚æœé€‰æ‹©çš„æ˜¯yesï¼Œå½“æˆªæ–­çš„aofæ–‡ä»¶è¢«å¯¼å…¥çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å‘å¸ƒä¸€ä¸ªlogç»™å®¢æˆ·ç«¯ç„¶åloadã€‚å¦‚æœæ˜¯noï¼Œç”¨æˆ·å¿…é¡»æ‰‹åŠ¨redis-check-aofä¿®å¤AOFæ–‡ä»¶æ‰å¯ä»¥ã€‚</span><br><span class="line">aof-load-truncated yes</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">############################ LUA SCRIPTINGï¼ˆLUA è„šæœ¬ï¼‰ ###########################</span><br><span class="line"> </span><br><span class="line"># å¦‚æœè¾¾åˆ°æœ€å¤§æ—¶é—´é™åˆ¶ï¼ˆæ¯«ç§’ï¼‰ï¼Œredisä¼šè®°ä¸ªlogï¼Œç„¶åè¿”å›errorã€‚å½“ä¸€ä¸ªè„šæœ¬è¶…è¿‡äº†æœ€å¤§æ—¶é™ã€‚</span><br><span class="line"># åªæœ‰SCRIPT KILLå’ŒSHUTDOWN NOSAVEå¯ä»¥ç”¨ã€‚ç¬¬ä¸€ä¸ªå¯ä»¥æ€æ²¡æœ‰è°ƒwriteå‘½ä»¤çš„ä¸œè¥¿ã€‚</span><br><span class="line"># è¦æ˜¯å·²ç»è°ƒç”¨äº†writeï¼Œåªèƒ½ç”¨ç¬¬äºŒä¸ªå‘½ä»¤æ€ã€‚</span><br><span class="line">lua-time-limit 5000</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">############################ REDIS CLUSTERï¼ˆRedisé›†ç¾¤ï¼‰ ###########################</span><br><span class="line"> </span><br><span class="line"># é›†ç¾¤å¼€å…³ï¼Œé»˜è®¤æ˜¯ä¸å¼€å¯é›†ç¾¤æ¨¡å¼ã€‚</span><br><span class="line"># cluster-enabled yes</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># é›†ç¾¤é…ç½®æ–‡ä»¶çš„åç§°ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªé›†ç¾¤ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼ŒæŒä¹…åŒ–ä¿å­˜é›†ç¾¤çš„ä¿¡æ¯ã€‚</span><br><span class="line"># è¿™ä¸ªæ–‡ä»¶æ— éœ€æ‰‹åŠ¨é…ç½®ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶æœ‰Redisç”Ÿæˆå¹¶æ›´æ–°ï¼Œæ¯ä¸ªRedisé›†ç¾¤èŠ‚ç‚¹éœ€è¦ä¸€ä¸ªå•ç‹¬çš„é…ç½®æ–‡ä»¶ï¼Œ# è¯·ç¡®ä¿ä¸å®ä¾‹è¿è¡Œçš„ç³»ç»Ÿä¸­é…ç½®æ–‡ä»¶åç§°ä¸å†²çª</span><br><span class="line"># cluster-config-file nodes-6379.conf</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># èŠ‚ç‚¹äº’è¿è¶…æ—¶çš„é˜€å€¼ã€‚é›†ç¾¤èŠ‚ç‚¹è¶…æ—¶æ¯«ç§’æ•°</span><br><span class="line"># cluster-node-timeout 15000</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># åœ¨è¿›è¡Œæ•…éšœè½¬ç§»æ—¶ï¼Œå…¨éƒ¨slaveä¼šè¯·æ±‚ç”³è¯·ä¸ºmasterï¼Œæœ‰äº›slaveå¯èƒ½ä¸masteræ–­å¼€è¿æ¥ä¸€æ®µæ—¶é—´äº†ï¼Œ</span><br><span class="line"># å¯¼è‡´æ•°æ®è¿‡äºé™ˆæ—§ï¼Œè¿™ç§slaveä¸è¯¥æå‡ä¸ºmasterã€‚è¯¥å‚æ•°åˆ¤æ–­slaveä¸masteræ–­çº¿çš„æ—¶é—´æ˜¯å¦è¿‡é•¿ã€‚</span><br><span class="line"># åˆ¤æ–­æ–¹æ³•æ˜¯ï¼šæ¯”è¾ƒslaveæ–­å¼€è¿æ¥çš„æ—¶é—´å’Œ</span><br><span class="line">#   (node-timeout * slave-validity-factor) + repl-ping-slave-period</span><br><span class="line"># å¦‚æœèŠ‚ç‚¹è¶…æ—¶æ—¶é—´ä¸ºä¸‰åç§’, å¹¶ä¸”slave-validity-factorä¸º10</span><br><span class="line"># å‡è®¾é»˜è®¤çš„repl-ping-slave-periodæ˜¯10ç§’ï¼Œå³å¦‚æœè¶…è¿‡310ç§’slaveå°†ä¸ä¼šå°è¯•è¿›è¡Œæ•…éšœè½¬ç§» </span><br><span class="line"># cluster-slave-validity-factor 10</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># masterçš„slaveæ•°é‡å¤§äºè¯¥å€¼ï¼Œslaveæ‰èƒ½è¿ç§»åˆ°å…¶ä»–å­¤ç«‹masterä¸Šï¼Œå¦‚è¿™ä¸ªå‚æ•°è‹¥è¢«è®¾ä¸º2ï¼Œ</span><br><span class="line"># é‚£ä¹ˆåªæœ‰å½“ä¸€ä¸ªä¸»èŠ‚ç‚¹æ‹¥æœ‰2 ä¸ªå¯å·¥ä½œçš„ä»èŠ‚ç‚¹æ—¶ï¼Œå®ƒçš„ä¸€ä¸ªä»èŠ‚ç‚¹ä¼šå°è¯•è¿ç§»ã€‚</span><br><span class="line"># cluster-migration-barrier 1</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># é»˜è®¤æƒ…å†µä¸‹ï¼Œé›†ç¾¤å…¨éƒ¨çš„slotæœ‰èŠ‚ç‚¹è´Ÿè´£ï¼Œé›†ç¾¤çŠ¶æ€æ‰ä¸ºokï¼Œæ‰èƒ½æä¾›æœåŠ¡ã€‚</span><br><span class="line"># è®¾ç½®ä¸ºnoï¼Œå¯ä»¥åœ¨slotæ²¡æœ‰å…¨éƒ¨åˆ†é…çš„æ—¶å€™æä¾›æœåŠ¡ã€‚</span><br><span class="line"># ä¸å»ºè®®æ‰“å¼€è¯¥é…ç½®ï¼Œè¿™æ ·ä¼šé€ æˆåˆ†åŒºæ—¶ï¼Œå°åˆ†åŒºçš„masterä¸€ç›´åœ¨æ¥å—å†™è¯·æ±‚ï¼Œè€Œé€ æˆå¾ˆé•¿æ—¶é—´æ•°æ®ä¸ä¸€è‡´ã€‚</span><br><span class="line"># cluster-require-full-coverage yes</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">############################## SLOW LOG ï¼ˆæ…¢æ—¥å¿—ï¼‰#############################</span><br><span class="line"> </span><br><span class="line"># slog logæ˜¯ç”¨æ¥è®°å½•redisè¿è¡Œä¸­æ‰§è¡Œæ¯”è¾ƒæ…¢çš„å‘½ä»¤è€—æ—¶ã€‚</span><br><span class="line"># å½“å‘½ä»¤çš„æ‰§è¡Œè¶…è¿‡äº†æŒ‡å®šæ—¶é—´ï¼Œå°±è®°å½•åœ¨slow logä¸­ï¼Œslog logä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥æ²¡æœ‰IOæ“ä½œã€‚</span><br><span class="line"># æ‰§è¡Œæ—¶é—´æ¯”slowlog-log-slower-thanå¤§çš„è¯·æ±‚è®°å½•åˆ°slowlogé‡Œé¢ï¼Œå•ä½æ˜¯å¾®ç§’</span><br><span class="line"># æ‰€ä»¥1000000å°±æ˜¯1ç§’ã€‚æ³¨æ„ï¼Œè´Ÿæ•°æ—¶é—´ä¼šç¦ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè€Œ0åˆ™ä¼šå¼ºåˆ¶è®°å½•æ‰€æœ‰å‘½ä»¤ã€‚</span><br><span class="line">slowlog-log-slower-than 10000</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># æ…¢æŸ¥è¯¢æ—¥å¿—é•¿åº¦ã€‚å½“ä¸€ä¸ªæ–°çš„å‘½ä»¤è¢«å†™è¿›æ—¥å¿—æ—¶ï¼Œæœ€è€çš„é‚£ä¸ªè®°å½•ä¼šè¢«åˆ æ‰ã€‚</span><br><span class="line"># è¿™ä¸ªé•¿åº¦æ²¡æœ‰é™åˆ¶ã€‚åªè¦æœ‰è¶³å¤Ÿçš„å†…å­˜å°±è¡Œã€‚ä½ å¯ä»¥é€šè¿‡ SLOWLOG RESET æ¥é‡Šæ”¾å†…å­˜ã€‚</span><br><span class="line">slowlog-max-len 1024</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">############################ VIRTUAL MEMORYï¼ˆ è™šæ‹Ÿå†…å­˜ï¼‰ ###########################</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># æŒ‡å®šæ˜¯å¦å¯ç”¨è™šæ‹Ÿå†…å­˜æœºåˆ¶ï¼Œé»˜è®¤noï¼Œ</span><br><span class="line"># VMæœºåˆ¶å°†æ•°æ®åˆ†é¡µå­˜æ”¾ï¼Œç”±Rediså°†è®¿é—®é‡è¾ƒå°‘çš„é¡µå³å†·æ•°æ®swapåˆ°ç£ç›˜ä¸Šï¼ˆå†…å­˜å ç”¨å¤šï¼Œæœ€å¥½å…³é—­ï¼‰</span><br><span class="line"># è®¿é—®å¤šçš„é¡µé¢ç”±ç£ç›˜è‡ªåŠ¨æ¢å‡ºåˆ°å†…å­˜ä¸­</span><br><span class="line"># vm-enabled no</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># è™šæ‹Ÿå†…å­˜æ–‡ä»¶ä½ç½®ï¼Œé»˜è®¤å€¼ä¸º/tmp/redis.swapï¼Œä¸å¯å¤šä¸ªRediså®ä¾‹å…±äº«</span><br><span class="line"># Redisäº¤æ¢æ–‡ä»¶æœ€å¥½çš„å­˜å‚¨æ˜¯SSDï¼ˆå›ºæ€ç¡¬ç›˜ï¼‰</span><br><span class="line">#vm-swap-file /tmp/redis.swap</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># redisä½¿ç”¨çš„æœ€å¤§å†…å­˜ä¸Šé™ï¼Œä¿æŠ¤redisä¸ä¼šå› è¿‡å¤šä½¿ç”¨ç‰©ç†å†…å­˜å½±å“æ€§èƒ½</span><br><span class="line"># å°†å¤§äºvm-max-memoryçš„æ•°æ®å­˜å…¥è™šæ‹Ÿå†…å­˜ï¼Œä½†æ— è®ºè®¾ç½®å¤šå°‘ï¼Œæ‰€æœ‰ç´¢å¼•æ•°æ®éƒ½æ˜¯å†…å­˜å­˜å‚¨çš„ï¼ˆå³keysï¼‰</span><br><span class="line"># å½“vm-max-memoryè®¾ç½®ä¸º0æ—¶ï¼Œæ‰€æœ‰valueéƒ½å­˜åœ¨äºç£ç›˜ã€‚é»˜è®¤å€¼ä¸º0</span><br><span class="line">#vm-max-memory 0</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># Redis swapæ–‡ä»¶åˆ†æˆäº†å¾ˆå¤šçš„pageï¼Œä¸€ä¸ªå¯¹è±¡å¯ä»¥ä¿å­˜åœ¨å¤šä¸ªpageä¸Šé¢</span><br><span class="line"># ä½†ä¸€ä¸ªpageä¸Šä¸èƒ½è¢«å¤šä¸ªå¯¹è±¡å…±äº«ï¼Œvm-page-sizeæ˜¯è¦æ ¹æ®å­˜å‚¨çš„æ•°æ®å¤§å°æ¥è®¾å®šçš„ã€‚</span><br><span class="line"># å»ºè®®ï¼š</span><br><span class="line">#    å¦‚æœå­˜å‚¨å¾ˆå¤šå°å¯¹è±¡ï¼Œpageå¤§å°è®¾ç½®ä¸º32æˆ–64å­—èŠ‚ï¼›</span><br><span class="line">#    å¦‚æœå­˜å‚¨å¾ˆå¤§çš„å¯¹è±¡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ›´å¤§çš„pageï¼Œå¦‚æœä¸ç¡®å®šï¼Œå°±ä½¿ç”¨é»˜è®¤å€¼</span><br><span class="line"># æ¯ä¸ªé¡µé¢çš„å¤§å°è®¾ç½®ä¸º32å­—èŠ‚</span><br><span class="line">#vm-page-size 32</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># è®¾ç½®swapæ–‡ä»¶ä¸­é¡µé¢æ•°é‡</span><br><span class="line"># ç”±äºé¡µè¡¨ï¼ˆä¸€ç§è¡¨ç¤ºé¡µé¢ç©ºé—²æˆ–ä½¿ç”¨çš„bitmapï¼‰æ˜¯å­˜æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œåœ¨ç£ç›˜ä¸Šæ¯8ä¸ªé¡µå°†æ¶ˆè€—1byteçš„å†…å­˜</span><br><span class="line"># swapç©ºé—´æ€»å®¹é‡ä¸º vm-page-size * vm-pages</span><br><span class="line">#vm-pages 134217728</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># è®¾ç½®è®¿é—®swapæ–‡ä»¶çš„çº¿ç¨‹æ•°ï¼Œæœ€åä¸è¦è¶…è¿‡æœºå™¨çš„æ ¸æ•°</span><br><span class="line"># å¦‚æœè®¾ç½®ä¸º0ï¼Œé‚£ä¹ˆæ‰€æœ‰å¯¹swapæ–‡ä»¶çš„æ“ä½œéƒ½æ˜¯ä¸²è¡Œçš„ï¼Œå¯èƒ½ä¼šé€ æˆæ¯”è¾ƒé•¿æ—¶é—´çš„å»¶è¿Ÿï¼Œé»˜è®¤å€¼ä¸º4</span><br><span class="line">#vm-max-threads 4</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">############################ ADVANCED CONFIGï¼ˆé«˜çº§é…ç½®ï¼‰ ###########################</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">## å“ˆå¸Œè¡¨ä¸­å…ƒç´ ï¼ˆæ¡ç›®ï¼‰æ€»ä¸ªæ•°&lt;=512ä¸ªï¼Œé‡‡ç”¨ziplistï¼Œå¦åˆ™ä½¿ç”¨hash</span><br><span class="line">#hash-max-zipmap-entries 512   </span><br><span class="line"># </span><br><span class="line">## å“ˆå¸Œè¡¨ä¸­æ¯ä¸ªvalueçš„é•¿åº¦&lt;=64å­—èŠ‚æ—¶ï¼Œé‡‡ç”¨ziplistï¼Œå¦åˆ™ä½¿ç”¨hash</span><br><span class="line">#hash-max-zipmap-value 64     </span><br><span class="line"># </span><br><span class="line"># </span><br><span class="line"># </span><br><span class="line"># </span><br><span class="line">## listå…ƒç´ &lt;=512ä¸ªï¼Œé‡‡ç”¨ziplistï¼Œå¦åˆ™ç”¨linkedlist</span><br><span class="line">#list-max-ziplist-entries 512</span><br><span class="line"># </span><br><span class="line">## listå†…æŸä¸ªå…ƒç´ å¤§å°&lt;=64å­—èŠ‚æ—¶ï¼Œé‡‡ç”¨ziplistï¼Œå¦åˆ™ç”¨linkedlist </span><br><span class="line">#list-max-ziplist-value 64</span><br><span class="line"># </span><br><span class="line"># </span><br><span class="line"># </span><br><span class="line"># </span><br><span class="line">## setå†…å…ƒç´ æ•°é‡&lt;=512ä¸ªï¼Œä¸”éƒ½æ˜¯æ•´æ•°å‹å€¼ï¼Œé‡‡ç”¨insetï¼Œå¦åˆ™ä½¿ç”¨hashtable</span><br><span class="line">#set-max-intset-entries 512</span><br><span class="line"># </span><br><span class="line"># </span><br><span class="line"># </span><br><span class="line">## zsetå†…å…ƒç´ æ•°é‡&lt;=128ä¸ªï¼Œé‡‡ç”¨ziplistï¼Œå¦åˆ™ç”¨skiplistè·³è¡¨ </span><br><span class="line">#zset-max-ziplist-entries 128</span><br><span class="line"># </span><br><span class="line">## zsetå†…æŸä¸ªå…ƒç´ å¤§å°&lt;=64å­—èŠ‚æ—¶ï¼Œé‡‡ç”¨ziplistï¼Œå¦åˆ™ç”¨skiplistè·³è¡¨ </span><br><span class="line">#zset-max-ziplist-value 64</span><br><span class="line"># </span><br><span class="line"># </span><br><span class="line"># </span><br><span class="line">## valueå¤§å° &lt;= hll-sparse-max-bytesä½¿ç”¨ç¨€ç–æ•°æ®ç»“æ„ï¼ˆsparseï¼‰</span><br><span class="line">## valueå¤§å° &gt; hll-sparse-max-bytesä½¿ç”¨ç¨ å¯†çš„æ•°æ®ç»“æ„ï¼ˆdenseï¼‰ã€‚</span><br><span class="line">## ä¸€ä¸ªæ¯”16000å¤§çš„valueæ˜¯å‡ ä¹æ²¡ç”¨çš„ï¼Œå»ºè®®çš„valueå¤§æ¦‚ä¸º3000ã€‚</span><br><span class="line">## å¦‚æœå¯¹CPUè¦æ±‚ä¸é«˜ï¼Œå¯¹ç©ºé—´è¦æ±‚è¾ƒé«˜çš„ï¼Œå»ºè®®è®¾ç½®åˆ°10000å·¦å³ã€‚</span><br><span class="line">#hll-sparse-max-bytes 3000</span><br><span class="line"># </span><br><span class="line"># </span><br><span class="line">## Rediså°†åœ¨æ¯100æ¯«ç§’æ—¶ä½¿ç”¨1æ¯«ç§’çš„CPUæ—¶é—´æ¥å¯¹redisçš„hashè¡¨è¿›è¡Œé‡æ–°hashï¼Œå¯ä»¥é™ä½å†…å­˜çš„ä½¿ç”¨ã€‚</span><br><span class="line">## å½“ä½ çš„ä½¿ç”¨åœºæ™¯ä¸­ï¼Œæœ‰éå¸¸ä¸¥æ ¼çš„å®æ—¶æ€§éœ€è¦ï¼Œä¸èƒ½å¤Ÿæ¥å—Redisæ—¶ä¸æ—¶çš„å¯¹è¯·æ±‚æœ‰2æ¯«ç§’çš„å»¶è¿Ÿçš„è¯</span><br><span class="line">## æŠŠè¿™é¡¹é…ç½®ä¸ºnoã€‚å¦‚æœæ²¡æœ‰è¿™ä¹ˆä¸¥æ ¼çš„å®æ—¶æ€§è¦æ±‚ï¼Œå¯ä»¥è®¾ç½®ä¸ºyesï¼Œä»¥ä¾¿èƒ½å¤Ÿå°½å¯èƒ½å¿«çš„é‡Šæ”¾å†…å­˜ã€‚</span><br><span class="line">## æŒ‡å®šæ˜¯å¦æ¿€æ´»é‡ç½®å“ˆå¸Œï¼Œé»˜è®¤ä¸ºå¼€å¯</span><br><span class="line">#activerehashing yes</span><br><span class="line"># </span><br><span class="line"># </span><br><span class="line"># </span><br><span class="line">## å¯¹å®¢æˆ·ç«¯è¾“å‡ºç¼“å†²è¿›è¡Œé™åˆ¶,å¯ä»¥å¼ºè¿«é‚£äº›ä¸ä»æœåŠ¡å™¨è¯»å–æ•°æ®çš„å®¢æˆ·ç«¯æ–­å¼€è¿æ¥</span><br><span class="line">## ç”¨æ¥å¼ºåˆ¶å…³é—­ä¼ è¾“ç¼“æ…¢çš„å®¢æˆ·ç«¯ã€‚</span><br><span class="line">## å¯¹äºnormal clientï¼Œç¬¬ä¸€ä¸ª0è¡¨ç¤ºå–æ¶ˆhard limitï¼Œç¬¬äºŒä¸ª0å’Œç¬¬ä¸‰ä¸ª0è¡¨ç¤ºå–æ¶ˆsoft limit</span><br><span class="line">## normal clienté»˜è®¤å–æ¶ˆé™åˆ¶ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰å¯»é—®ï¼Œä»–ä»¬æ˜¯ä¸ä¼šæ¥æ”¶æ•°æ®çš„ã€‚</span><br><span class="line">#client-output-buffer-limit normal 0 0 0</span><br><span class="line"># </span><br><span class="line"># </span><br><span class="line">## å¯¹äºslave clientå’Œ MONITER clientï¼Œå¦‚æœclient-output-bufferä¸€æ—¦è¶…è¿‡256mb</span><br><span class="line">## åˆæˆ–è€…è¶…è¿‡64mbæŒç»­60ç§’ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¼šç«‹å³æ–­å¼€å®¢æˆ·ç«¯è¿æ¥ã€‚</span><br><span class="line">#client-output-buffer-limit slave 256mb 64mb 60</span><br><span class="line"># </span><br><span class="line"># </span><br><span class="line">## å¯¹äºpubsub clientï¼Œå¦‚æœclient-output-bufferä¸€æ—¦è¶…è¿‡32mbï¼Œåˆæˆ–è€…è¶…è¿‡8mbæŒç»­60ç§’ï¼Œ</span><br><span class="line">## é‚£ä¹ˆæœåŠ¡å™¨å°±ä¼šç«‹å³æ–­å¼€å®¢æˆ·ç«¯è¿æ¥ã€‚</span><br><span class="line">#client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class="line"># </span><br><span class="line"># </span><br><span class="line">## redisæ‰§è¡Œä»»åŠ¡çš„é¢‘ç‡ä¸º1sé™¤ä»¥hzã€‚</span><br><span class="line">#hz 10</span><br><span class="line"># </span><br><span class="line"># </span><br><span class="line">## åœ¨AOFé‡å†™æ—¶ï¼Œå¦‚æœæ‰“å¼€äº†aof-rewrite-incremental-fsyncå¼€å…³ï¼Œç³»ç»Ÿä¼šæ¯32MBæ‰§è¡Œä¸€æ¬¡fsyncã€‚</span><br><span class="line">## è¿™å¯¹äºæŠŠæ–‡ä»¶å†™å…¥ç£ç›˜æ˜¯æœ‰å¸®åŠ©çš„ï¼Œå¯ä»¥é¿å…è¿‡å¤§çš„å»¶è¿Ÿå³°å€¼ã€‚</span><br><span class="line">#aof-rewrite-incremental-fsync yes</span><br><span class="line"># </span><br></pre></td></tr></table></figure><p>docker-compose å®‰è£… slave</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:latest</span><br><span class="line">    container_name: redis-slave</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&#x27;6002:6379&#x27;</span></span><br><span class="line">    volumes:</span><br><span class="line">      - ./data:/data</span><br><span class="line">      - ./redis.conf:/usr/local/etc/redis/redis.conf</span><br><span class="line">      - ./logs:/logs</span><br><span class="line">    <span class="comment">#é…ç½®æ–‡ä»¶å¯åŠ¨</span></span><br><span class="line">    <span class="built_in">command</span>: redis-server /usr/local/etc/redis/redis.conf</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS                                       NAMES</span><br><span class="line">73059d0c67e0   redis:latest   <span class="string">&quot;docker-entrypoint.sâ€¦&quot;</span>   2 minutes ago   Up 2 minutes   0.0.0.0:6002-&gt;6379/tcp, :::6002-&gt;6379/tcp   redis-slave</span><br><span class="line">772912adc2ba   redis:latest   <span class="string">&quot;docker-entrypoint.sâ€¦&quot;</span>   8 minutes ago   Up 6 minutes   0.0.0.0:6001-&gt;6379/tcp, :::6001-&gt;6379/tcp   redis-master</span><br></pre></td></tr></table></figure><h2 id="ä»èŠ‚ç‚¹è®¾ç½®"><a href="#ä»èŠ‚ç‚¹è®¾ç½®" class="headerlink" title="ä»èŠ‚ç‚¹è®¾ç½®"></a>ä»èŠ‚ç‚¹è®¾ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">192.168.116.130:6002&gt; replicaof 192.168.116.130 6001</span><br><span class="line">OK</span><br><span class="line">192.168.116.130:6002&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:192.168.116.130</span><br><span class="line">master_port:6001</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:4</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_read_repl_offset:14</span><br><span class="line">slave_repl_offset:14</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">replica_announced:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:5af78b7d5a9c7e6e83222284ef0a9a08f3bcc0ef</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:14</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:15</span><br><span class="line">repl_backlog_histlen:0</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>åœ¨6001ç«¯å£çš„rediså†™å…¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.116.130:6001&gt; <span class="built_in">set</span> aki akievergarden</span><br><span class="line">OK</span><br><span class="line">192.168.116.130:6001&gt; </span><br></pre></td></tr></table></figure><p>åœ¨6002ç«¯å£çš„redisè¯»å–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.116.130:6002&gt; get aki</span><br><span class="line">akievergarden</span><br><span class="line">192.168.116.130:6002</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¾“å…¥<code>replicaof no one</code>ï¼Œå³å¯å˜å›Masterè§’è‰²</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">192.168.116.130:6002&gt; replicaof no one</span><br><span class="line">OK</span><br><span class="line">192.168.116.130:6002&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:d7db775eb6f89e2f047edc81bd8ef9a5c754e679</span><br><span class="line">master_replid2:5af78b7d5a9c7e6e83222284ef0a9a08f3bcc0ef</span><br><span class="line">master_repl_offset:513</span><br><span class="line">second_repl_offset:514</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:15</span><br><span class="line">repl_backlog_histlen:499</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä½¿ç”¨-docker-redis-è¿›è¡Œä¸»ä»å¤åˆ¶æµ‹è¯•&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨-docker-redis-è¿›è¡Œä¸»ä»å¤åˆ¶æµ‹è¯•&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨ docker redis è¿›è¡Œä¸»ä»å¤åˆ¶æµ‹è¯•&quot;&gt;&lt;/a&gt;ä½¿ç”¨ docker redi</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="https://blog.akievergarden.top/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="Redis" scheme="https://blog.akievergarden.top/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>Linuxä¸‹çš„Redisç¼–è¯‘å®‰è£…</title>
    <link href="https://blog.akievergarden.top/2023/10/15/Linux%E4%B8%8B%E7%9A%84Redis%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/"/>
    <id>https://blog.akievergarden.top/2023/10/15/Linux%E4%B8%8B%E7%9A%84Redis%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/</id>
    <published>2023-10-15T09:12:13.000Z</published>
    <updated>2024-03-20T12:59:53.194Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¯´åˆ°NoSQLæœç„¶å°±è¦æåˆ°Redisäº†ï¼Œæœ¬æ–‡ä¸­ä»‹ç»äº†å¦‚ä½•åœ¨Linuxä¸Šå®‰è£…Redisçš„è¿‡ç¨‹ã€‚</p><h1 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h1><p>åœ¨ <a href="https://redis.io/download/">https://redis.io/download/</a> ä¸­æ‰¾åˆ°download x.x.x çš„é“¾æ¥ï¼Œå³é”®å¤åˆ¶ä¸‹è½½åœ°å€,ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/redis/redis/archive/7.2.1.tar.gz</span><br></pre></td></tr></table></figure><p>åœ¨Linuxçš„å‘½ä»¤è¡Œä½¿ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/redis/redis/archive/7.2.1.tar.gz</span><br></pre></td></tr></table></figure><p>æ³¨æ„åœ¨é‚£ä¹‹å‰è¿›è¡Œæƒé™ææƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -i</span><br></pre></td></tr></table></figure><p>ç„¶åredisçš„tar.gz å‹ç¼©åŒ…å°±åœ¨ &#x2F;root çš„ç›®å½•ä¸‹ï¼Œè¿›è¡Œè§£å‹æ“ä½œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxf 7.2.1.tar.gz</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ -zxf åˆ†åˆ«æ˜¯ï¼š</p><ol><li>-zï¼šä½¿ç”¨ gzip å‹ç¼©&#x2F;è§£å‹ç¼©ã€‚è¿™ä¸ªé€‰é¡¹å‘Šè¯‰ tar å‘½ä»¤ä½¿ç”¨ gzip å‹ç¼©ç®—æ³•æ¥å¤„ç†æ–‡ä»¶ã€‚</li><li>-xï¼šæå–æ–‡ä»¶ã€‚è¿™ä¸ªé€‰é¡¹å‘Šè¯‰ tar å‘½ä»¤è¦ä»å½’æ¡£æ–‡ä»¶ä¸­æå–æ–‡ä»¶ã€‚</li><li>-fï¼šæŒ‡å®šå½’æ¡£æ–‡ä»¶ã€‚è¿™ä¸ªé€‰é¡¹åé¢éœ€è¦æ¥å½’æ¡£æ–‡ä»¶çš„è·¯å¾„æˆ–åç§°ã€‚</li></ol><p>è§£å‹ä¹‹åèƒ½è·å¾—ä¸€ä¸ª &#x2F;redis.x.x.x çš„æ–‡ä»¶å¤¹</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>å°†è§£å‹åçš„æ–‡ä»¶å¤¹ç§»åŠ¨åˆ°&#x2F;usr&#x2F;localä¸‹ï¼Œå¹¶å‘½åä¸ºæ–°çš„æ–‡ä»¶å¤¹redis(å½“ç„¶ä½ ä¸åœ¨è¿™ä¹ˆåšä¹Ÿè¡Œ)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> redis-7.2.1 /usr/local/redis</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä»¥ä¸‹ç¨‹åºè¿›è¡Œç¼–è¯‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/redis</span><br><span class="line">make PREFIX=/usr/local/redis install</span><br></pre></td></tr></table></figure><p>å…¶ä¸­PREFIX ä¸ºæŒ‡å®šç¼–è¯‘å®‰è£…åçš„ç›®å½•ï¼Œå¦‚æœä¸æŒ‡å®š Linuxä¼šå°†å¯æ‰§è¡Œæ–‡ä»¶å­˜æ”¾åœ¨&#x2F;usr&#x2F;local&#x2F;binç›®å½•ï¼Œåº“æ–‡ä»¶ä¼šå­˜æ”¾åœ¨&#x2F;usr&#x2F;local&#x2F;libç›®å½•</p><h1 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h1><p>å®Œæˆå®‰è£…ä¹‹å åœ¨&#x2F;usr&#x2F;local&#x2F;redisç›®å½•ä¸‹ä¼šå¤šå‡º binå¯æ‰§è¡Œæ–‡ä»¶ç›®å½•</p><p>åœ¨è¿è¡Œä¹‹å‰ å…ˆäº†è§£ redis.conf ï¼Œå¦‚åŒå­—é¢æ„æ€ï¼Œå®ƒæ˜¯é…ç½®æ–‡ä»¶ã€‚æ ¹æ®æ–‡ä»¶ä¸­å‰å‡ è¡Œçš„æè¿°ï¼Œå¯ä»¥è¿™æ ·ä½¿ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Note that in order to read the configuration file, Redis must be</span></span><br><span class="line"><span class="comment"># started with the file path as first argument:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ./redis-server /path/to/redis.conf</span></span><br><span class="line">./bin/redis-server ./redis.conf <span class="comment">#åœ¨/usr/local/redis ç›®å½•ä¸‹</span></span><br></pre></td></tr></table></figure><p>æ–‡ä»¶ä¸­æœ‰å¤§éƒ¨åˆ†æ³¨é‡Šçš„è‹±æ–‡è§£é‡Šï¼Œä»¥ä¸‹åªè®²å‡ ä¸ªé…ç½®æ—¶ç”¨å¾—ä¸Šçš„</p><p>1.<br>    <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################## NETWORK #####################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># By default, if no &quot;bind&quot; configuration directive is specified, Redis listens</span></span><br><span class="line"><span class="comment"># for connections from all available network interfaces on the host machine.</span></span><br><span class="line"><span class="comment"># It is possible to listen to just one or multiple selected interfaces using</span></span><br><span class="line"><span class="comment"># the &quot;bind&quot; configuration directive, followed by one or more IP addresses.</span></span><br><span class="line"><span class="comment"># Each address can be prefixed by &quot;-&quot;, which means that redis will not fail to</span></span><br><span class="line"><span class="comment"># start if the address is not available. Being not available only refers to</span></span><br><span class="line"><span class="comment"># addresses that does not correspond to any network interface. Addresses that</span></span><br><span class="line"><span class="comment"># are already in use will always fail, and unsupported protocols will always BE</span></span><br><span class="line"><span class="comment"># silently skipped.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Examples:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># bind 192.168.1.100 10.0.0.1     # listens on two specific IPv4 addresses</span></span><br><span class="line"><span class="comment"># bind 127.0.0.1 ::1              # listens on loopback IPv4 and IPv6</span></span><br><span class="line"><span class="comment"># bind * -::*                     # like the default, all available interfaces</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ~~~ WARNING ~~~ If the computer running Redis is directly exposed to the</span></span><br><span class="line"><span class="comment"># internet, binding to all the interfaces is dangerous and will expose the</span></span><br><span class="line"><span class="comment"># instance to everybody on the internet. So by default we uncomment the</span></span><br><span class="line"><span class="comment"># following bind directive, that will force Redis to listen only on the</span></span><br><span class="line"><span class="comment"># IPv4 and IPv6 (if available) loopback interface addresses (this means Redis</span></span><br><span class="line"><span class="comment"># will only be able to accept client connections from the same host that it is</span></span><br><span class="line"><span class="comment"># running on).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># IF YOU ARE SURE YOU WANT YOUR INSTANCE TO LISTEN TO ALL THE INTERFACES</span></span><br><span class="line"><span class="comment"># COMMENT OUT THE FOLLOWING LINE.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You will also need to set a password unless you explicitly disable protected</span></span><br><span class="line"><span class="comment"># mode.</span></span><br><span class="line"><span class="comment"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span><br><span class="line"><span class="built_in">bind</span> 127.0.0.1 -::1</span><br></pre></td></tr></table></figure></p><pre><code>é»˜è®¤ä¸‹ Redisåªå…è®¸æœ¬æœºé“¾æ¥ï¼›å¦‚æœéœ€è¦å±€åŸŸç½‘æˆ–è€…å¤–ç½‘çš„å¦ä¸€å°ä¸»æœºé“¾æ¥çš„è¯éœ€è¦bindé“¾æ¥ä¸»æœºçš„ipåœ°å€ï¼Œå¦‚æœå¸Œæœ›ä»»ä½•çš„ä¸»æœºéƒ½èƒ½é“¾æ¥çš„è¯ï¼Œä¿®æ”¹æˆ–åŠ å…¥<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> * -::*</span><br></pre></td></tr></table></figure></code></pre><p>2.<br>    <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># By default protected mode is enabled. You should disable it only if</span></span><br><span class="line"><span class="comment"># you are sure you want clients from other hosts to connect to Redis</span></span><br><span class="line"><span class="comment"># even if no authentication is configured.</span></span><br><span class="line">protected-mode <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><br>    è¿˜éœ€è¦å…³é—­protected-modeï¼Œæ‰èƒ½ä»å¦ä¸€å°ä¸»æœºé“¾æ¥<br>    <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protected-mode no</span><br></pre></td></tr></table></figure></p><p>3.<br>    <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Accept connections on the specified port, default is 6379 (IANA #815344).</span></span><br><span class="line"><span class="comment"># If port 0 is specified Redis will not listen on a TCP socket.</span></span><br><span class="line">port 6379</span><br></pre></td></tr></table></figure><br>    æ›´æ”¹port åçš„å†…å®¹ä»¥æ›´æ”¹ç«¯å£</p><p>4.<br>    <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################# GENERAL #####################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># By default Redis does not run as a daemon. Use &#x27;yes&#x27; if you need it.</span></span><br><span class="line"><span class="comment"># Note that Redis will write a pid file in /var/run/redis.pid when daemonized.</span></span><br><span class="line"><span class="comment"># When Redis is supervised by upstart or systemd, this parameter has no impact.</span></span><br><span class="line">daemonize no</span><br></pre></td></tr></table></figure><br>    ä»¥å®ˆæŠ¤çº¿ç¨‹è¿è¡ŒRedisï¼Œå½“Redisä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œæ—¶ï¼Œå®ƒä¼šåœ¨&#x2F;var&#x2F;run&#x2F;redis.pidå†™å…¥ä¸€ä¸ªpidæ–‡ä»¶<br>    <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">daemonize no</span><br></pre></td></tr></table></figure><br>5.<br>    <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># IMPORTANT <span class="doctag">NOTE:</span> starting with Redis 6 &quot;requirepass&quot; is just a compatibility</span></span><br><span class="line"><span class="comment"># layer on top of the new ACL system. The option effect will be just setting</span></span><br><span class="line"><span class="comment"># the password for the default user. Clients will still authenticate using</span></span><br><span class="line"><span class="comment"># AUTH &lt;password&gt; as usually, or more explicitly with AUTH default &lt;password&gt;</span></span><br><span class="line"><span class="comment"># if they follow the new protocol: both will work.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The requirepass is not compatible with aclfile option and the ACL LOAD</span></span><br><span class="line"><span class="comment"># command, these will cause requirepass to be ignored.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># requirepass foobared</span></span><br></pre></td></tr></table></figure><br>    é€šè¿‡ requirepass xxxxxx å¯ä»¥è®¾ç½®é»˜è®¤ç”¨æˆ·è®¤è¯å¯†ç ï¼Œè‡³å°‘6ä½å­—ç¬¦ï¼Œä¾‹å¦‚<br>    <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requirepass 1145141919810</span><br></pre></td></tr></table></figure></p><p>æœ€å</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/redis-server ./redis.conf </span><br></pre></td></tr></table></figure><h1 id="åè¯"><a href="#åè¯" class="headerlink" title="åè¯"></a>åè¯</h1><p>å¦‚æœä½ éœ€è¦å®ŒæˆRedisçš„å¼€æœºå¯åŠ¨çš„è¯ï¼Œå‚è€ƒä»¥ä¸‹ä¼˜ç§€æ–‡ç« ï¼š<br><a href="https://blog.csdn.net/m0_60721514/article/details/123777643">https://blog.csdn.net/m0_60721514/article/details/123777643</a> </p>]]></content>
    
    
    <summary type="html">è¯´åˆ°NoSQLæœç„¶å°±è¦æåˆ°Redisäº†ï¼Œæœ¬æ–‡ä¸­ä»‹ç»äº†å¦‚ä½•åœ¨Linuxä¸Šå®‰è£…Redisçš„è¿‡ç¨‹ã€‚</summary>
    
    
    
    <category term="å­¦ä¹ " scheme="https://blog.akievergarden.top/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="Redis" scheme="https://blog.akievergarden.top/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>JNIæœ¬åœ°æ–¹æ³•è°ƒç”¨åˆæ¢</title>
    <link href="https://blog.akievergarden.top/2023/10/06/JNI%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E5%88%9D%E6%8E%A2/"/>
    <id>https://blog.akievergarden.top/2023/10/06/JNI%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E5%88%9D%E6%8E%A2/</id>
    <published>2023-10-06T02:24:12.160Z</published>
    <updated>2024-03-20T12:59:53.194Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨ java ä¸­å¯ä»¥åœ¨æ–¹æ³•ä¸­æŒ‡å®šå…³é”®å­— native ä½¿å¾—javaå¯ä»¥è°ƒç”¨æœ¬åœ°ä»£ç ä¸­å¾—æ–¹æ³•ï¼Œå¦‚c\cppã€‚</p><p>æœ¬æ–‡æè¿°äº†å¦‚ä½•ç®€å•çš„è·‘é€šäº†åœ¨javaä¸­è°ƒç”¨æœ¬åœ°çš„ä¸€ä¸ªcppæ–¹æ³•çš„è¿‡ç¨‹ã€‚</p><h1 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h1><h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><ol><li>IntelliJ IDEA 2022.3.2 ç¼–å†™javaä»£ç </li><li>CLion 2023.2.2 ç¼–å†™cppä»£ç </li></ol><h2 id="java-ä»£ç "><a href="#java-ä»£ç " class="headerlink" title="java ä»£ç "></a>java ä»£ç </h2><h3 id="åˆ›å»ºä¸€ä¸ª-main-æ–‡ä»¶"><a href="#åˆ›å»ºä¸€ä¸ª-main-æ–‡ä»¶" class="headerlink" title="åˆ›å»ºä¸€ä¸ª main æ–‡ä»¶"></a>åˆ›å»ºä¸€ä¸ª main æ–‡ä»¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(sum(<span class="number">114</span>,<span class="number">514</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span>  <span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ä½¿ç”¨native å…³é”®å­—ï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•ä¸ºæœ¬åœ°æ–¹æ³•</p><h3 id="æ„å»ºè¯¥æ–‡ä»¶-ä»¥ä¸‹æ˜¯æ–‡ä»¶æ ‘ç»“æ„"><a href="#æ„å»ºè¯¥æ–‡ä»¶-ä»¥ä¸‹æ˜¯æ–‡ä»¶æ ‘ç»“æ„" class="headerlink" title="æ„å»ºè¯¥æ–‡ä»¶, ä»¥ä¸‹æ˜¯æ–‡ä»¶æ ‘ç»“æ„"></a>æ„å»ºè¯¥æ–‡ä»¶, ä»¥ä¸‹æ˜¯æ–‡ä»¶æ ‘ç»“æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€out</span><br><span class="line">â”‚  â””â”€production</span><br><span class="line">â”‚      â””â”€javaNative</span><br><span class="line">â”‚              Main.class</span><br><span class="line">â”‚</span><br><span class="line">â””â”€src</span><br><span class="line">     Main.java</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆè¯¥æœ¬åœ°æ–¹æ³•çš„å¤´æ–‡ä»¶"><a href="#ç”Ÿæˆè¯¥æœ¬åœ°æ–¹æ³•çš„å¤´æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆè¯¥æœ¬åœ°æ–¹æ³•çš„å¤´æ–‡ä»¶"></a>ç”Ÿæˆè¯¥æœ¬åœ°æ–¹æ³•çš„å¤´æ–‡ä»¶</h3><p>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•çš„powershellæˆ–è€…cmdä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javah -classpath out/production/javaNative -d ./jni Main</span><br></pre></td></tr></table></figure><p>æŒ‡ä»¤è§£é‡Šï¼š</p><ol><li>javah: è¡¨ç¤ºè¦è¿è¡Œjavahå‘½ä»¤ã€‚javahå‘½ä»¤ç”¨äºç”ŸæˆJavaç±»çš„æœ¬åœ°æ–¹æ³•æ¥å£ï¼ˆNative Method Interfaceï¼Œç®€ç§°JNIï¼‰å¤´æ–‡ä»¶ã€‚å®ƒå¯ä»¥æ ¹æ®Javaç±»ä¸­å£°æ˜çš„æœ¬åœ°æ–¹æ³•ç”Ÿæˆå¯¹åº”çš„C&#x2F;C++å¤´æ–‡ä»¶ï¼Œä»¥ä¾¿åœ¨æœ¬åœ°ä»£ç ä¸­å®ç°è¿™äº›æ–¹æ³•ã€‚</li><li>-classpath out&#x2F;production&#x2F;javaNative: æŒ‡å®šç¼–è¯‘åçš„Javaç±»æ–‡ä»¶æ‰€åœ¨çš„ç±»è·¯å¾„ã€‚è¿™é‡Œç¼–è¯‘åçš„ç±»æ–‡ä»¶ä½äºout&#x2F;production&#x2F;javaNativeç›®å½•ä¸­ã€‚</li><li>-d .&#x2F;jni: æŒ‡å®šç”Ÿæˆçš„JNIå¤´æ–‡ä»¶çš„è¾“å‡ºç›®å½•ã€‚è¿™é‡Œå°†ç”Ÿæˆçš„å¤´æ–‡ä»¶æ”¾åœ¨å½“å‰ç›®å½•ä¸‹çš„jniç›®å½•ä¸­ã€‚</li><li>Main: æŒ‡å®šè¦ç”ŸæˆJNIå¤´æ–‡ä»¶çš„Javaç±»åã€‚è¿™é‡Œç”Ÿæˆçš„JNIå¤´æ–‡ä»¶å°†ä¸åä¸ºMainçš„Javaç±»ç›¸å…³è”ã€‚</li></ol><h3 id="ä¹‹åå°±èƒ½åœ¨-x2F-jni-æ–‡ä»¶å¤¹ä¸‹çœ‹åˆ°-Main-h-çš„å¤´æ–‡ä»¶"><a href="#ä¹‹åå°±èƒ½åœ¨-x2F-jni-æ–‡ä»¶å¤¹ä¸‹çœ‹åˆ°-Main-h-çš„å¤´æ–‡ä»¶" class="headerlink" title="ä¹‹åå°±èƒ½åœ¨ &#x2F;jni æ–‡ä»¶å¤¹ä¸‹çœ‹åˆ° Main.h çš„å¤´æ–‡ä»¶"></a>ä¹‹åå°±èƒ½åœ¨ &#x2F;jni æ–‡ä»¶å¤¹ä¸‹çœ‹åˆ° Main.h çš„å¤´æ–‡ä»¶</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* DO NOT EDIT THIS FILE - it is machine generated */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="comment">/* Header for class Main */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _Included_Main</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _Included_Main</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Class:     Main</span></span><br><span class="line"><span class="comment">* Method:    sum</span></span><br><span class="line"><span class="comment">* Signature: (II)I &lt;--(II)è¡¨æ˜ä¼ å…¥ä¸¤ä¸ªIntç±»å‹å‚æ•°ï¼ŒIè¡¨æ˜è¿”å›ä¸€ä¸ªIntç±»å‹ç»“æœ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">JNIEXPORT jint JNICALL Java_Main_sum <span class="comment">//&lt;-- ä¸ºè¦æ±‚å®ç°çš„æ–¹æ³•</span></span><br><span class="line">(JNIEnv *, jclass, jint, jint);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h2 id="cpp-ä»£ç "><a href="#cpp-ä»£ç " class="headerlink" title="cpp ä»£ç "></a>cpp ä»£ç </h2><h3 id="ä½¿ç”¨Clion"><a href="#ä½¿ç”¨Clion" class="headerlink" title="ä½¿ç”¨Clion"></a>ä½¿ç”¨Clion</h3><ol><li><p>åˆ›å»ºä¸€ä¸ªé¡¹ç›®</p></li><li><p>åœ¨é¡¹ç›®ä¸­çš„ CMakeList.txtä¸­å¼•å…¥æ–¹æ‰javaç¼–è¯‘ä½¿ç”¨çš„jdkçš„includeç›®å½•å’Œinclude&#x2F;win32æ–‡ä»¶ï¼Œä¾‹å¦‚:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">include_directories(&quot;C:/Program Files/Eclipse Adoptium/jdk-8.0.382.5-hotspot/include&quot;)</span><br><span class="line"></span><br><span class="line">include_directories(&quot;C:/Program Files/Eclipse Adoptium/jdk-8.0.382.5-hotspot/include/win32&quot;)</span><br></pre></td></tr></table></figure></li><li><p>å°† &#x2F;jni æ–‡ä»¶å¤¹ä¸‹çœ‹åˆ° Main.h çš„å¤´æ–‡ä»¶ åŠ å…¥é¡¹ç›®çš„æ ¹ç›®å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â”‚  CMakeLists.txt</span><br><span class="line"> â”‚  main.cpp</span><br><span class="line"> â”‚  Main.h &lt;---- æ–¹åœ¨ä¸main.cpp åŒçº§åˆ«</span><br><span class="line"> â”‚</span><br><span class="line"> â”œâ”€.idea</span><br><span class="line"> â”‚      ...</span><br><span class="line"> â”‚</span><br><span class="line"> â””â”€cmake-build-debug</span><br><span class="line">     ...</span><br></pre></td></tr></table></figure></li></ol><h3 id="ç¼–å†™cppå®ç°å¤´æ–‡ä»¶ä¸­è¦æ±‚å®ç°çš„æ–¹æ³•"><a href="#ç¼–å†™cppå®ç°å¤´æ–‡ä»¶ä¸­è¦æ±‚å®ç°çš„æ–¹æ³•" class="headerlink" title="ç¼–å†™cppå®ç°å¤´æ–‡ä»¶ä¸­è¦æ±‚å®ç°çš„æ–¹æ³•"></a>ç¼–å†™cppå®ç°å¤´æ–‡ä»¶ä¸­è¦æ±‚å®ç°çš„æ–¹æ³•</h3><ol><li><p>åœ¨ main.cpp æ–‡ä»¶ä¸­å†™å…¥ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Main.h&quot;</span></span></span><br><span class="line"> <span class="function">JNIEXPORT jint JNICALL <span class="title">Java_Main_sum</span></span></span><br><span class="line"><span class="function">         <span class="params">(JNIEnv *, jclass, jint a, jint b)</span></span>&#123; <span class="comment">//ä»…ä»…ä½¿ç”¨äº†åè¾¹çš„jint</span></span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> a+b;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><ol><li>JNIEXPORT jint JNICALL: è¿™æ˜¯ä¸€ä¸ªç”¨äºæŒ‡å®šå‡½æ•°å¯¼å‡ºçš„å®å®šä¹‰ã€‚å®ƒå‘Šè¯‰ç¼–è¯‘å™¨å°†è¿™ä¸ªå‡½æ•°ä½œä¸ºåŠ¨æ€é“¾æ¥åº“çš„å¯¼å‡ºå‡½æ•°ã€‚JNIEXPORTæ˜¯ä¸€ä¸ªå®ï¼Œç”¨äºæŒ‡å®šå‡½æ•°çš„å¯¼å‡ºç±»å‹ã€‚jintè¡¨ç¤ºå‡½æ•°çš„è¿”å›ç±»å‹æ˜¯intã€‚</li><li>Java_Main_sum: è¿™æ˜¯ä¸€ä¸ªçº¦å®šçš„å‘½åè§„åˆ™ï¼Œç”¨äºè¡¨ç¤ºè¿™ä¸ªJNIå‡½æ•°ä¸Javaç±»Mainä¸­çš„sumæ–¹æ³•ç›¸å¯¹åº”ã€‚åœ¨JNIä¸­ï¼Œå‡½æ•°åçš„å‘½åè§„åˆ™æ˜¯Java_&lt;ç±»å&gt;_&lt;æ–¹æ³•å&gt;ã€‚</li><li>(JNIEnv *, jclass, jint, jint): è¿™æ˜¯å‡½æ•°çš„å‚æ•°åˆ—è¡¨ã€‚åœ¨JNIä¸­ï¼Œå‡½æ•°çš„å‰ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯JNIEnvå’Œjclassç±»å‹çš„æŒ‡é’ˆï¼Œç”¨äºä¸Javaè™šæ‹Ÿæœºè¿›è¡Œäº¤äº’ã€‚åé¢çš„ä¸¤ä¸ªå‚æ•°æ˜¯jintç±»å‹çš„æ•´æ•°å‚æ•°ã€‚</li></ol></li><li><p>jniä¸­çš„ç±»å‹ä¸Javaçš„åŸºæœ¬ç±»å‹ç›¸ä¼¼ï¼Œä»…ä»…éœ€è¦åœ¨javaçš„åŸºæœ¬ç±»å‹å‰åŠ å…¥jï¼›ä¾‹å¦‚Javaä¸­Booleanï¼Œåœ¨jniä¸­åˆ™ä¸ºjbooleanï¼›Byte&lt;â€“&gt;jbyte ã€‚ã€‚ã€‚</p></li></ol><h3 id="ç¼–è¯‘ç”ŸæˆåŠ¨æ€åº“"><a href="#ç¼–è¯‘ç”ŸæˆåŠ¨æ€åº“" class="headerlink" title="ç¼–è¯‘ç”ŸæˆåŠ¨æ€åº“"></a>ç¼–è¯‘ç”ŸæˆåŠ¨æ€åº“</h3><p>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•çš„powershellæˆ–è€…cmdä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc main.cpp -I &quot;C:/Program Files/Eclipse Adoptium/jdk-<span class="number">8</span>.<span class="number">0</span>.<span class="number">382</span>.<span class="number">5</span>-hotspot/include&quot; -I &quot;C:/Program Files/Eclipse Adoptium/jdk-<span class="number">8</span>.<span class="number">0</span>.<span class="number">382</span>.<span class="number">5</span>-hotspot/include/win32&quot; -shared -o main.dll -lstdc++</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><ol><li>gcc main.cpp ä½¿ç”¨gccç¼–è¯‘main.cppæ–‡ä»¶</li><li>-I â€œâ€¦â€ å¼•å…¥æ–‡ä»¶</li><li>-shared æŒ‡å®šç”ŸæˆåŠ¨æ€é“¾æ¥åº“</li><li>-o main.dll æŒ‡å®šç”Ÿæˆæ–‡ä»¶åå­—</li><li>-lstdc++ é“¾æ¥windowsä¸Šçš„cppæ ‡å‡†åº“</li></ol><p>æœ€åå°±å¯ä»¥åœ¨é¡¹ç›®çš„æ›´ç›®å½•åˆ° main.dll æ–‡ä»¶äº†</p><h2 id="åœ¨Javaä¸­ä½¿ç”¨è¯¥dllæ–‡ä»¶"><a href="#åœ¨Javaä¸­ä½¿ç”¨è¯¥dllæ–‡ä»¶" class="headerlink" title="åœ¨Javaä¸­ä½¿ç”¨è¯¥dllæ–‡ä»¶"></a>åœ¨Javaä¸­ä½¿ç”¨è¯¥dllæ–‡ä»¶</h2><ol><li>å°†ç”Ÿæˆçš„main.dllæ–‡ä»¶æ”¾åœ¨æ–¹æ‰çš„javaé¡¹ç›®çš„æ›´ç›®å½•</li><li>åœ¨java Main.java ä¸­åŠ è½½è¯¥.dllæ–‡ä»¶ï¼Œä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ System.getProperty(&quot;user.dir&quot;) è·å–é¡¹ç›®çš„è·¯å¾„</span></span><br><span class="line">        System.load(System.getProperty(<span class="string">&quot;user.dir&quot;</span>) + <span class="string">&quot;/mian.dll&quot;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(sum(<span class="number">114</span>,<span class="number">514</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span>  <span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>ç¼–è¯‘è¿è¡Œå¾—åˆ°ç»“æœï¼š<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">628</span></span><br><span class="line"></span><br><span class="line">è¿›ç¨‹å·²ç»“æŸ,é€€å‡ºä»£ç <span class="number">0</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="åè¯"><a href="#åè¯" class="headerlink" title="åè¯"></a>åè¯</h1><p>å°šä¸æ¸…æ¥š JNIEnv *, jclass çš„ä½œç”¨ï¼Œç•™æœ‰ä¹‹åæ¢ç©¶ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨ java ä¸­å¯ä»¥åœ¨æ–¹æ³•ä¸­æŒ‡å®šå…³é”®å­— native ä½¿å¾—javaå¯ä»¥è°ƒç”¨æœ¬åœ°ä»£ç ä¸­å¾—æ–¹æ³•ï¼Œå¦‚c\cppã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æè¿°äº†å¦‚ä½•ç®€å•</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="https://blog.akievergarden.top/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="JVM" scheme="https://blog.akievergarden.top/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>openjdk-8çš„ç¼–è¯‘</title>
    <link href="https://blog.akievergarden.top/2023/09/28/openjdk-8%E7%9A%84%E7%BC%96%E8%AF%91/"/>
    <id>https://blog.akievergarden.top/2023/09/28/openjdk-8%E7%9A%84%E7%BC%96%E8%AF%91/</id>
    <published>2023-09-28T09:19:42.567Z</published>
    <updated>2024-03-20T12:59:53.194Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ‰‹åŠ¨ç¼–è¯‘ä¸€ä¸ªjdk8"><a href="#æ‰‹åŠ¨ç¼–è¯‘ä¸€ä¸ªjdk8" class="headerlink" title="æ‰‹åŠ¨ç¼–è¯‘ä¸€ä¸ªjdk8"></a>æ‰‹åŠ¨ç¼–è¯‘ä¸€ä¸ªjdk8</h1><p>å­¦ä¹ JVMè‡ªç„¶æ˜¯è¦å…ˆè‡ªå·±æ„å»ºä¸€ä¸ªjdk,åšåˆ°ç®¡ä¸­çª¥è±¹ï¼Œä»è€Œä¸ä¼šæ— ä»ä¸‹æ‰‹ã€‚</p><h1 id="å‰ç½®å‡†å¤‡"><a href="#å‰ç½®å‡†å¤‡" class="headerlink" title="å‰ç½®å‡†å¤‡"></a>å‰ç½®å‡†å¤‡</h1><h2 id="ç³»ç»Ÿå‡†å¤‡"><a href="#ç³»ç»Ÿå‡†å¤‡" class="headerlink" title="ç³»ç»Ÿå‡†å¤‡"></a>ç³»ç»Ÿå‡†å¤‡</h2><p>æœ¬æ¬¡æ„å»ºjdk-8ä½¿ç”¨çš„æ˜¯ ubuntu-22.04.3-live-server-amd64ï¼Œå†…æ ¸ç‰ˆæœ¬ä¸ºï¼šGNU&#x2F;Linux 5.15.0-84-generic x86_64</p><h2 id="ç¡¬ä»¶å‡†å¤‡"><a href="#ç¡¬ä»¶å‡†å¤‡" class="headerlink" title="ç¡¬ä»¶å‡†å¤‡"></a>ç¡¬ä»¶å‡†å¤‡</h2><p>åŸºäºVMware çš„è™šæ‹Ÿæœºï¼Œåˆ†é…host AMD Ryzen 7 3800X 8-Core Processor 8æ ¸å¿ƒ 8GBå†…å­˜</p><h2 id="è°ƒè¯•å·¥å…·"><a href="#è°ƒè¯•å·¥å…·" class="headerlink" title="è°ƒè¯•å·¥å…·"></a>è°ƒè¯•å·¥å…·</h2><p>Jetbrians Clion ä½¿ç”¨Remote Developmenté“¾æ¥Ubuntuè™šæ‹Ÿæœº</p><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p>æ ¹æ® <a href="https://hg.openjdk.org/jdk8/jdk8/raw-file/tip/README-builds.html">https://hg.openjdk.org/jdk8/jdk8/raw-file/tip/README-builds.html</a> å¾—çŸ¥é“ï¼šç¼–è¯‘ç¯å¢ƒæ¨èä¸ºï¼š</p><ol><li>gcc: 4.8</li><li>g++: 4.8</li><li>make: 3.81</li><li>bootstrap JDK: OpenJDK8</li></ol><h2 id="OpenJDK8æºç "><a href="#OpenJDK8æºç " class="headerlink" title="OpenJDK8æºç "></a>OpenJDK8æºç </h2><p><a href="https://codeload.github.com/openjdk/jdk/zip/refs/tags/jdk8-b120">https://codeload.github.com/openjdk/jdk/zip/refs/tags/jdk8-b120</a></p><h2 id="åŸºæœ¬ä¾èµ–"><a href="#åŸºæœ¬ä¾èµ–" class="headerlink" title="åŸºæœ¬ä¾èµ–"></a>åŸºæœ¬ä¾èµ–</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install build-essential libxrender-dev xorg-dev libasound2-dev libcups2-dev gawk zip libxtst-dev libxi-dev libxt-dev gobjc</span><br></pre></td></tr></table></figure><h1 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h1><h2 id="ç”±äºåœ¨ubuntu22-04-3-ä¸­æ²¡æœ‰gcc-4-8-çš„æºï¼Œ-éœ€è¦å¯¼å…¥æ—§ç‰ˆçš„æº"><a href="#ç”±äºåœ¨ubuntu22-04-3-ä¸­æ²¡æœ‰gcc-4-8-çš„æºï¼Œ-éœ€è¦å¯¼å…¥æ—§ç‰ˆçš„æº" class="headerlink" title="ç”±äºåœ¨ubuntu22.04.3 ä¸­æ²¡æœ‰gcc 4.8 çš„æºï¼Œ éœ€è¦å¯¼å…¥æ—§ç‰ˆçš„æº"></a>ç”±äºåœ¨ubuntu22.04.3 ä¸­æ²¡æœ‰gcc 4.8 çš„æºï¼Œ éœ€è¦å¯¼å…¥æ—§ç‰ˆçš„æº</h2>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/apt/sources.list</span><br></pre></td></tr></table></figure><p>   åœ¨æœ€ä¸‹æ–¹æ·»åŠ æ—§ç‰ˆæºåœ°å€å¹¶ä¿å­˜</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">deb http://archive.ubuntu.com/ubuntu xenial main</span><br><span class="line">deb http://archive.ubuntu.com/ubuntu xenial universe</span><br></pre></td></tr></table></figure><p>   æ›´æ–°aptæºä¿¡æ¯ï¼Œå¹¶å®‰è£…gccå’Œg++</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install gcc-4.8 g++-4.8</span><br></pre></td></tr></table></figure><p>   åœ¨æ›´æ–°è¿‡ç¨‹ä¸­ æˆ‘é‡åˆ°äº†</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Err:5 http://archive.ubuntu.com/ubuntu xenial InRelease</span><br><span class="line">The following signatures couldn<span class="string">&#x27;t be verified because the public key is not available: NO_PUBKEY 40976EAF437D05B5 NO_PUBKEY 3B4FE6ACC0B21F32</span></span><br><span class="line"><span class="string">Reading package lists... Done</span></span><br><span class="line"><span class="string">W: GPG error: http://archive.ubuntu.com/ubuntu xenial InRelease: The following signatures couldn&#x27;</span>t be verified because the public key is not available: NO_PUBKEY 40976EAF437D05B5 NO_PUBKEY 3B4FE6ACC0B21F32</span><br><span class="line">E: The repository <span class="string">&#x27;http://archive.ubuntu.com/ubuntu xenial InRelease&#x27;</span> is not signed.</span><br><span class="line">N: Updating from such a repository can<span class="string">&#x27;t be done securely, and is therefore disabled by default.</span></span><br><span class="line"><span class="string">N: See apt-secure(8) manpage for repository creation and user configuration details.</span></span><br></pre></td></tr></table></figure><p>   è¿™æ˜¯å› ä¸ºç³»ç»Ÿæ— æ³•è¯†åˆ«æŸäº›GPGå…¬é’¥ï¼ˆPUBKEYï¼‰å¯¼è‡´çš„ã€‚éœ€è¦åšçš„æ˜¯åœ¨ç³»ç»Ÿä¸­è·å–è¿™äº›ç¼ºå¤±çš„å…¬é’¥ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥è·å–è¿™äº›å…¬é’¥ï¼š</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 40976EAF437D05B5 3B4FE6ACC0B21F32</span><br></pre></td></tr></table></figure><p>   è®¾ç½®å®‰è£…çš„gcc g++4.8 ä¸ºé¦–é€‰</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.8 100</span><br><span class="line">sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.8 100</span><br></pre></td></tr></table></figure><p>   æŸ¥çœ‹ç‰ˆæœ¬ï¼š</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@aki:~<span class="comment"># g++ --version</span></span><br><span class="line">g++ (Ubuntu 4.8.5-4ubuntu2) 4.8.5</span><br><span class="line">Copyright (C) 2015 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the <span class="built_in">source</span> <span class="keyword">for</span> copying conditions.  There is NO</span><br><span class="line">warranty; not even <span class="keyword">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br><span class="line"></span><br><span class="line">root@aki:~<span class="comment"># gcc --version</span></span><br><span class="line">gcc (Ubuntu 4.8.5-4ubuntu2) 4.8.5</span><br><span class="line">Copyright (C) 2015 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the <span class="built_in">source</span> <span class="keyword">for</span> copying conditions.  There is NO</span><br><span class="line">warranty; not even <span class="keyword">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…make-3-81ç‰ˆæœ¬"><a href="#å®‰è£…make-3-81ç‰ˆæœ¬" class="headerlink" title="å®‰è£…make 3.81ç‰ˆæœ¬"></a>å®‰è£…make 3.81ç‰ˆæœ¬</h2><p>   ä»å®˜æ–¹ä¸‹è½½ï¼š</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://ftp.gnu.org/gnu/make/make-3.81.tar.gz</span><br></pre></td></tr></table></figure><p>   ä¸‹è½½å®Œæˆä¹‹åï¼š</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf make-3.81.tar.gz </span><br><span class="line"><span class="built_in">cd</span> make-3.81/</span><br></pre></td></tr></table></figure><p>   æ¥ç€ä¿®æ”¹ä»£ç ï¼Œæ‰“å¼€glob&#x2F;glob.cæ–‡ä»¶ï¼š</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">#ifdef  HAVE_CONFIG_H</span></span><br><span class="line"><span class="comment"># include &lt;config.h&gt;</span></span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define __alloca alloca   &lt;- æ·»åŠ è¿™ä¸€å¥</span></span><br><span class="line"><span class="comment">#define __stat stat   &lt;- æ·»åŠ è¿™ä¸€å¥</span></span><br><span class="line">/* Enable GNU extensions </span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>   é˜²æ­¢ä¹‹åå‡ºç°æŠ¥é”™ï¼š</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/ld: /root/make-3.81/glob/glob.c:955: undefined reference to `__stat<span class="string">&#x27;</span></span><br><span class="line"><span class="string">/usr/bin/ld: /root/make-3.81/glob/glob.c:809: undefined reference to `__stat&#x27;</span></span><br><span class="line">collect2: error: ld returned 1 <span class="built_in">exit</span> status</span><br><span class="line">make[1]: *** [Makefile:411: make] Error 1</span><br><span class="line">make[1]: Leaving directory <span class="string">&#x27;/root/make-3.81&#x27;</span></span><br><span class="line">make: *** [Makefile:603: install-recursive] Error 1</span><br></pre></td></tr></table></figure><p>   ç„¶åè¿›è¡Œå®‰è£… make-3.81</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash configure</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><p>   åˆ é™¤æœ€æ–°çš„make</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt remove make -y <span class="comment">#åˆ é™¤ä¹‹å‰aptè£…çš„makeï¼Œå…¶ä½ç½®åœ¨/usr/bin/make</span></span><br></pre></td></tr></table></figure><p>   åˆ é™¤é“¾æ¥</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> /usr/bin/make</span><br></pre></td></tr></table></figure><p>   æµ‹è¯•ï¼š</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">make -version</span><br><span class="line">GNU Make 3.81</span><br><span class="line">Copyright (C) 2006  Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the <span class="built_in">source</span> <span class="keyword">for</span> copying conditions.</span><br><span class="line">There is NO warranty; not even <span class="keyword">for</span> MERCHANTABILITY or FITNESS FOR A</span><br><span class="line">PARTICULAR PURPOSE.</span><br><span class="line"></span><br><span class="line">This program built <span class="keyword">for</span> x86_64-unknown-linux-gnu</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…bootstrap-JDK-OpenJDK8"><a href="#å®‰è£…bootstrap-JDK-OpenJDK8" class="headerlink" title="å®‰è£…bootstrap JDK: OpenJDK8"></a>å®‰è£…bootstrap JDK: OpenJDK8</h2><p>   ç”±äºJDKä¸­æŸäº›ä»£ç æ˜¯Javaç¼–å†™çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å®‰è£…ä¸€ä¸ªå¯åŠ¨JDKï¼Œå¯åŠ¨JDKå¯ä»¥æ˜¯å½“å‰ç‰ˆæœ¬æˆ–ä½ä¸€ç‰ˆæœ¬ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦ç¼–è¯‘JDK8çš„æºç ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨JDK7ã€JDK8ä½œä¸ºå¯åŠ¨JDKï¼Œå¯¹æºç ä¸­çš„ä¸€äº›javaæ–‡ä»¶è¿›è¡Œç¼–è¯‘ã€‚è¿™é‡Œæˆ‘ä»¬é€‰æ‹©å®‰è£… openjdk8ä½œä¸ºå¯åŠ¨JDKï¼š</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install openjdk-8-jdk</span><br></pre></td></tr></table></figure><h2 id="ç¼–è¯‘openjdk8"><a href="#ç¼–è¯‘openjdk8" class="headerlink" title="ç¼–è¯‘openjdk8"></a>ç¼–è¯‘openjdk8</h2><p>   è§£å‹</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip jdk8-b120</span><br></pre></td></tr></table></figure><p>   è¿›å…¥ç›®å½•</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> jdk-jdk8-b120/</span><br></pre></td></tr></table></figure><p>   ä¿®æ”¹æ–‡ä»¶ä»¥æ”¯æŒå½“å‰linuxå†…æ ¸ï¼š<br>   é¦–å…ˆæ˜¯hotspot&#x2F;make&#x2F;linux&#x2F;Makefileæ–‡ä»¶</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åŸæœ‰çš„ SUPPORTED_OS_VERSION = 2.4% 2.5% 2.6% 3%</span><br><span class="line">ä¿®æ”¹ä¸º SUPPORTED_OS_VERSION = 2.4% 2.5% 2.6% 3% 4% 5%</span><br></pre></td></tr></table></figure><p>   æ¥ç€æ˜¯hotspot&#x2F;make&#x2F;linux&#x2F;makefiles&#x2F;gcc.makeæ–‡ä»¶ï¼š</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åŸæœ‰çš„ WARNINGS_ARE_ERRORS = -Werror</span><br><span class="line">ä¿®æ”¹ä¸º <span class="comment">#WARNINGS_ARE_ERRORS = -Werror</span></span><br></pre></td></tr></table></figure><p>   æ¥ç€æ˜¯nashorn&#x2F;make&#x2F;BuildNashorn.gmkæ–‡ä»¶ï¼š</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$(CP) -R -p $(NASHORN_OUTPUTDIR)/nashorn_classes/* $(@D)/</span><br><span class="line">$(FIXPATH) $(JAVA) \</span><br><span class="line">åŸæœ‰çš„ -<span class="built_in">cp</span> <span class="string">&quot;<span class="subst">$(NASHORN_OUTPUTDIR)</span>/nasgen_classes<span class="subst">$(PATH_SEP)</span><span class="subst">$(NASHORN_OUTPUTDIR)</span>/nashorn_classes&quot;</span> \</span><br><span class="line">ä¿®æ”¹ä¸º  -Xbootclasspath/p:<span class="string">&quot;<span class="subst">$(NASHORN_OUTPUTDIR)</span>/nasgen_classes<span class="subst">$(PATH_SEP)</span><span class="subst">$(NASHORN_OUTPUTDIR)</span>/nashorn_classes&quot;</span> \</span><br><span class="line"></span><br><span class="line">jdk.nashorn.internal.tools.nasgen.Main $(@D) jdk.nashorn.internal.objects $(@D)</span><br></pre></td></tr></table></figure><p>   æ‰§è¡Œç¼–è¯‘å‰çš„configure</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash configure --with-debug-level=slowdebug --enable-debug-symbols ZIP_DEBUGINFO_FIELS=0</span><br></pre></td></tr></table></figure><p>   å«ä¹‰è§£è¯»ï¼š</p><ol><li>â€“with-debug-level&#x3D;slowdebug  ç”Ÿæˆä¸€ä¸ªå¸¦æœ‰è°ƒè¯•ä¿¡æ¯çš„OpenJDK8ç‰ˆæœ¬ï¼Œslowdebugè¡¨ç¤ºè°ƒè¯•çº§åˆ«æ˜¯æœ€ä½çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¼šæ¯”è¾ƒå°ï¼Œä½†æ˜¯è°ƒè¯•ä¿¡æ¯ä¼šæ¯”è¾ƒå°‘</li><li>â€“enable-debug-symbols åœ¨ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­åŒ…å«è°ƒè¯•ç¬¦å·ï¼Œè¿™æ ·å¯ä»¥åœ¨ä½¿ç”¨è°ƒè¯•å·¥å…·æ—¶ï¼Œçœ‹åˆ°æºä»£ç ä¸­çš„å˜é‡åå’Œå‡½æ•°åç­‰</li><li>ZIP_DEBUGINFO_FIELS&#x3D;0 ä¸è¦å°†è°ƒè¯•ä¿¡æ¯æ‰“åŒ…æˆzipæ–‡ä»¶ï¼Œè€Œæ˜¯ç›´æ¥æ”¾åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­</li></ol><p>   ç¼–è¯‘</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make all</span><br></pre></td></tr></table></figure><p>   é‡åˆ°é—®é¢˜</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/home/jdk8/jdk/src/solaris/native/java/net/PlainDatagramSocketImpl.c:38:24: fatal error: sys/sysctl.h: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•</span><br><span class="line"><span class="comment">#include &lt;sys/sysctl.h&gt;</span></span><br><span class="line">                        ^</span><br><span class="line">compilation terminated.</span><br><span class="line">/home/jdk8/jdk/src/solaris/native/java/net/PlainSocketImpl.c:46:24: fatal error: sys/sysctl.h: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•</span><br><span class="line"><span class="comment">#include &lt;sys/sysctl.h&gt;</span></span><br><span class="line">                        ^</span><br><span class="line">compilation terminated.</span><br><span class="line">In file included from /home/jdk8/jdk/src/share/native/java/net/net_util.c:29:0:</span><br><span class="line">/home/jdk8/jdk/src/share/native/java/net/net_util.c: In <span class="keyword">function</span> â€˜NET_SockaddrToInetAddressâ€™:</span><br><span class="line">/home/jdk8/jdk/src/share/native/java/net/net_util.h:46:41: warning: comparison between pointer and <span class="built_in">integer</span> [enabled by default]</span><br><span class="line"><span class="comment">#define CHECK_NULL_RETURN(x, y) if ((x) == NULL) return y;</span></span><br><span class="line">                                        ^</span><br><span class="line">/home/jdk8/jdk/src/share/native/java/net/net_util.c:268:13: note: <span class="keyword">in</span> expansion of macro â€˜CHECK_NULL_RETURNâ€™</span><br><span class="line">            CHECK_NULL_RETURN(ret, NULL);</span><br><span class="line">            ^</span><br><span class="line">gmake[2]: *** [lib/NetworkingLibraries.gmk:57ï¼š/home/jdk8/build/linux-x86_64-normal-server-release/jdk/objs/libnet/PlainDatagramSocketImpl.o] é”™è¯¯ 1</span><br><span class="line">gmake[2]: *** æ­£åœ¨ç­‰å¾…æœªå®Œæˆçš„ä»»åŠ¡....</span><br><span class="line">gmake[2]: *** [lib/NetworkingLibraries.gmk:57ï¼š/home/jdk8/build/linux-x86_64-normal-server-release/jdk/objs/libnet/PlainSocketImpl.o] é”™è¯¯ 1</span><br><span class="line">gmake[1]: *** [BuildJdk.gmk:70ï¼šlibs-only] é”™è¯¯ 2</span><br><span class="line">make: *** [/home/jdk8//make/Main.gmk:116ï¼šjdk-only] é”™è¯¯ 2</span><br></pre></td></tr></table></figure><p>   è¿™ä¸ªæŠ¥é”™çš„ä¸»è¦åŸå› æ˜¯éšç€ glibc 2.32 çš„å‘å¸ƒï¼ŒLinux ç³»ç»Ÿåˆ é™¤äº†sys&#x2F;sysctl.hã€‚</p><p>   å› æ­¤è§£å†³æ–¹å¼åªéœ€è¦æŠŠopenjdk8ç›®å½•ä¸‹çš„:</p><p>   jdk&#x2F;src&#x2F;solaris&#x2F;native&#x2F;java&#x2F;net&#x2F;PlainDatagramSocketImpl.c ä¸­çš„38è¡Œ<br>   jdk&#x2F;src&#x2F;solaris&#x2F;native&#x2F;java&#x2F;net&#x2F;PlainSocketImpl.cä¸­çš„46è¡Œæ³¨é‡Šæ‰å°±è¡Œ</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;sys/sysctl.h&gt; æ”¹æˆ</span></span><br><span class="line">// <span class="comment">#include &lt;sys/sysctl.h&gt;</span></span><br></pre></td></tr></table></figure><p>   å‚è€ƒæ¥è‡ªï¼š<a href="https://blog.csdn.net/weixin_50955418/article/details/126716611">https://blog.csdn.net/weixin_50955418/article/details/126716611</a></p><p>   æœ€åæˆåŠŸä¼šæ˜¾ç¤º</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">----- Build <span class="built_in">times</span> -------</span><br><span class="line">Start 2023-09-28 17:07:31</span><br><span class="line">End   2023-09-28 17:09:01</span><br><span class="line">00:00:00 corba</span><br><span class="line">00:00:06 demos</span><br><span class="line">00:00:56 docs</span><br><span class="line">00:00:00 hotspot</span><br><span class="line">00:00:08 images</span><br><span class="line">00:00:00 jaxp</span><br><span class="line">00:00:00 jaxws</span><br><span class="line">00:00:14 jdk</span><br><span class="line">00:00:00 langtools</span><br><span class="line">00:00:05 nashorn</span><br><span class="line">00:01:30 TOTAL</span><br><span class="line">-------------------------</span><br><span class="line">Finished building OpenJDK <span class="keyword">for</span> target <span class="string">&#x27;all&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>   åœ¨jdk-jdk8-b120&#x2F; ç›®å½•ä¸­è¾“å…¥ï¼š</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build/linux-x86_64-normal-server-slowdebug/jdk/bin/java -version</span><br></pre></td></tr></table></figure><p>   å¾—åˆ°ç»“æœ</p>   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openjdk version <span class="string">&quot;1.8.0-internal-debug&quot;</span></span><br><span class="line"> OpenJDK Runtime Environment (build 1.8.0-internal-debug-root_2023_09_28_16_55-b00)</span><br><span class="line"> OpenJDK 64-Bit Server VM (build 25.0-b62-debug, mixed mode)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">å­¦ä¹ JVMå‰çš„openjdk8ç¼–è¯‘</summary>
    
    
    
    <category term="å­¦ä¹ " scheme="https://blog.akievergarden.top/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="JVM" scheme="https://blog.akievergarden.top/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>b2äº‘å­˜å‚¨ä¸cloudflareSaaSçš„ipç²¾é€‰</title>
    <link href="https://blog.akievergarden.top/2023/05/27/b2%E4%BA%91%E5%AD%98%E5%82%A8%E4%B8%8EcloudflareSaaS%E7%9A%84ip%E7%B2%BE%E9%80%89/"/>
    <id>https://blog.akievergarden.top/2023/05/27/b2%E4%BA%91%E5%AD%98%E5%82%A8%E4%B8%8EcloudflareSaaS%E7%9A%84ip%E7%B2%BE%E9%80%89/</id>
    <published>2023-05-27T19:42:59.000Z</published>
    <updated>2024-03-20T12:59:53.194Z</updated>
    
    <content type="html"><![CDATA[<h1 id="è¯´å®è¯ï¼š-ä¸æ˜¯å¾ˆç¨³å®šï¼Œè¿™å°±ä¸æ¨èäº†"><a href="#è¯´å®è¯ï¼š-ä¸æ˜¯å¾ˆç¨³å®šï¼Œè¿™å°±ä¸æ¨èäº†" class="headerlink" title="è¯´å®è¯ï¼š ä¸æ˜¯å¾ˆç¨³å®šï¼Œè¿™å°±ä¸æ¨èäº†"></a>è¯´å®è¯ï¼š ä¸æ˜¯å¾ˆç¨³å®šï¼Œè¿™å°±ä¸æ¨èäº†</h1><p>å³ä½¿è¿›è¡Œäº†ipç²¾é€‰ï¼Œç¨³å®šæ€§èƒ½ä¹Ÿå¾ˆä½ï¼Œæ—¶ä¸æ—¶åŠ è½½ä¸å‡ºå›¾ï¼Œå³ä½¿èƒ½åŠ è½½å›¾ç‰‡ï¼Œé€Ÿç‡ä¹Ÿå¾ˆæ…¢ï¼ˆï¼Œä¸å»ºè®®è´¹æ—¶é—´</p>]]></content>
    
    
    <summary type="html">è¯´å®è¯ï¼šÂ ä¸æ˜¯å¾ˆç¨³å®šï¼Œè¿™å°±ä¸æ¨èäº†Â å³ä½¿è¿›è¡Œäº†ipç²¾é€‰ï¼Œç¨³å®šæ€§èƒ½ä¹Ÿå¾ˆä½ï¼Œæ—¶ä¸æ—¶åŠ è½½ä¸å‡ºå›¾ï¼Œå³ä½¿èƒ½åŠ è½½å›¾ç‰‡ï¼Œé€Ÿç‡ä¹Ÿå¾ˆæ…¢ï¼ˆï¼Œä¸å»ºè®®è´¹æ—¶é—´Â </summary>
    
    
    
    <category term="æ—¥å¸¸" scheme="https://blog.akievergarden.top/categories/%E6%97%A5%E5%B8%B8/"/>
    
    
    <category term="ç™½å«–" scheme="https://blog.akievergarden.top/tags/%E7%99%BD%E5%AB%96/"/>
    
  </entry>
  
  <entry>
    <title>javawebå®éªŒ</title>
    <link href="https://blog.akievergarden.top/2023/04/06/javaweb%E5%AE%9E%E9%AA%8C/"/>
    <id>https://blog.akievergarden.top/2023/04/06/javaweb%E5%AE%9E%E9%AA%8C/</id>
    <published>2023-04-06T08:39:52.000Z</published>
    <updated>2024-03-20T12:59:53.194Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›¸å¯¹è·¯å¾„"><a href="#ç›¸å¯¹è·¯å¾„" class="headerlink" title="ç›¸å¯¹è·¯å¾„"></a>ç›¸å¯¹è·¯å¾„</h1><p>ä½¿ç”¨ç›¸å¯¹è·¯å¾„è¿›è¡Œå›¾ç‰‡å±•ç¤º<p><p><img src="/pic/illust_93484813_20220917_200428.jpg" alt="ç›¸å¯¹è·¯å¾„"></p><h1 id="ç»å¯¹è·¯å¾„"><a href="#ç»å¯¹è·¯å¾„" class="headerlink" title="ç»å¯¹è·¯å¾„"></a>ç»å¯¹è·¯å¾„</h1><p>ä½¿ç”¨ç»å¯¹è·¯å¾„è¿›è¡Œå›¾ç‰‡å±•ç¤º<p><p><img src="https://img.mknacg.top:458/images/2020/04/01/BoxFront1.jpg" alt="ç»å¯¹è·¯å¾„"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ç›¸å¯¹è·¯å¾„&quot;&gt;&lt;a href=&quot;#ç›¸å¯¹è·¯å¾„&quot; class=&quot;headerlink&quot; title=&quot;ç›¸å¯¹è·¯å¾„&quot;&gt;&lt;/a&gt;ç›¸å¯¹è·¯å¾„&lt;/h1&gt;&lt;p&gt;ä½¿ç”¨ç›¸å¯¹è·¯å¾„è¿›è¡Œå›¾ç‰‡å±•ç¤º&lt;p&gt;

&lt;p&gt;&lt;img src=&quot;/pic/illust_93484813_20220917_20</summary>
      
    
    
    
    
    <category term="å®éªŒ" scheme="https://blog.akievergarden.top/tags/%E5%AE%9E%E9%AA%8C/"/>
    
  </entry>
  
</feed>
